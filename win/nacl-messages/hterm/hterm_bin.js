if("undefined"!=typeof lib)throw Error('Global "lib" object already exists.');
var lib={runtimeDependencies_:{},rtdep:function(a){for(var b=lib.getStack()[1],c=0;c<arguments.length;c++){var e=arguments[c],f=this.runtimeDependencies_[e];f||(f=this.runtimeDependencies_[e]=[]);f.push(b)}},ensureRuntimeDependencies:function(){var a=!0,b;for(b in lib.runtimeDependencies_)for(var c=lib.runtimeDependencies_[b],e=b.split("."),f=window||self,h=0;h<e.length;h++){if(!(e[h]in f)){console.warn('Missing "'+b+'" is needed by',c);a=!1;break}f=f[e[h]]}if(!a)throw Error("Failed runtime dependency check");
},getStack:function(a){var a=a?a+2:2,b;try{throw Error();}catch(c){b=c.stack.split("\n")}for(var e={},f=a;f<b.length;f++)e[f-a]=b[f].replace(/^\s*at\s+/,"");return e}};lib.colors={};
lib.colors.re_={hex16:/#([a-f0-9])([a-f0-9])([a-f0-9])/i,hex24:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/i,rgb:RegExp("^/s*rgb/s*/(/s*(/d{1,3})/s*,/s*(/d{1,3})/s*,/s*(/d{1,3})/s*/)/s*$".replace(/\//g,"\\"),"i"),rgba:RegExp("^/s*rgba/s*/(/s*(/d{1,3})/s*,/s*(/d{1,3})/s*,/s*(/d{1,3})/s*(?:,/s*(/d+(?:/./d+)?)/s*)/)/s*$".replace(/\//g,"\\"),"i"),rgbx:RegExp("^/s*rgba?/s*/(/s*(/d{1,3})/s*,/s*(/d{1,3})/s*,/s*(/d{1,3})/s*(?:,/s*(/d+(?:/./d+)?)/s*)?/)/s*$".replace(/\//g,"\\"),"i"),x11rgb:/^\s*rgb:([a-f0-9]{1,4})\/([a-f0-9]{1,4})\/([a-f0-9]{1,4})\s*$/i,name:/[a-z][a-z0-9\s]+/};
lib.colors.rgbToX11=function(a){function b(a){for(a=(257*Math.min(a,255)).toString(16);4>a.length;)a="0"+a;return a}a=a.match(lib.colors.re_.rgbx);return!a?null:"rgb:"+b(a[1])+"/"+b(a[2])+"/"+b(a[3])};lib.colors.x11ToCSS=function(a){var b=a.match(lib.colors.re_.x11rgb);return!b?lib.colors.nameToRGB(a):lib.colors.arrayToRGB(b[3])};
lib.colors.hexToRGB=function(a){function b(a){a=a.match(4==a.length?lib.colors.re_.hex16:lib.colors.re_.hex24);return!a?null:"rgb("+parseInt(a[1],16)+", "+parseInt(a[2],16)+", "+parseInt(a[3],16)+")"}if(a instanceof Array)for(var c=0;c<a.length;c++)a[c]=b(a[c]);else a=b(a);return a};lib.colors.normalizeCSS=function(a){return"#"==a.substr(0,1)?lib.colors.hexToRGB(a):lib.colors.re_.rgbx.test(a)?a:lib.colors.nameToRGB(a)};
lib.colors.arrayToRGBA=function(a){return"rgba("+a[0]+", "+a[1]+", "+a[2]+", "+(3<a.length?a[3]:1)+")"};lib.colors.setAlpha=function(a,b){var c=lib.colors.crackRGB(a);c[3]=b;return lib.colors.arrayToRGBA(c)};lib.colors.mix=function(a,b,c){for(var a=lib.colors.crackRGB(a),b=lib.colors.crackRGB(b),e=0;4>e;++e)a[e]+=(a[e]-b[e])*c;return lib.colors.arrayToRGBA(ary)};
lib.colors.crackRGB=function(a){if("rgba"==a.substr(0,4)){var b=a.match(lib.colors.re_.rgba);if(b)return b.shift(),b}else if(b=a.match(lib.colors.re_.rgb))return b.shift(),b.push(1),b;console.error("Couldn't crack: "+a);return null};lib.colors.nameToRGB=function(a){if(a in lib.colors.colorNames)return lib.colors.colorNames[a];a=a.toLowerCase();if(a in lib.colors.colorNames)return lib.colors.colorNames[a];a=a.replace(/\s+/g,"");return a in lib.colors.colorNames?lib.colors.colorNames[a]:null};
lib.colors.defaultColorPalette=lib.colors.hexToRGB("#000000 #CC0000 #4E9A06 #C4A000 #3465A4 #75507B #06989A #D3D7CF #555753 #EF2929 #00BA13 #FCE94F #729FCF #F200CB #00B5BD #EEEEEC #000000 #00005F #000087 #0000AF #0000D7 #0000FF #005F00 #005F5F #005F87 #005FAF #005FD7 #005FFF #008700 #00875F #008787 #0087AF #0087D7 #0087FF #00AF00 #00AF5F #00AF87 #00AFAF #00AFD7 #00AFFF #00D700 #00D75F #00D787 #00D7AF #00D7D7 #00D7FF #00FF00 #00FF5F #00FF87 #00FFAF #00FFD7 #00FFFF #5F0000 #5F005F #5F0087 #5F00AF #5F00D7 #5F00FF #5F5F00 #5F5F5F #5F5F87 #5F5FAF #5F5FD7 #5F5FFF #5F8700 #5F875F #5F8787 #5F87AF #5F87D7 #5F87FF #5FAF00 #5FAF5F #5FAF87 #5FAFAF #5FAFD7 #5FAFFF #5FD700 #5FD75F #5FD787 #5FD7AF #5FD7D7 #5FD7FF #5FFF00 #5FFF5F #5FFF87 #5FFFAF #5FFFD7 #5FFFFF #870000 #87005F #870087 #8700AF #8700D7 #8700FF #875F00 #875F5F #875F87 #875FAF #875FD7 #875FFF #878700 #87875F #878787 #8787AF #8787D7 #8787FF #87AF00 #87AF5F #87AF87 #87AFAF #87AFD7 #87AFFF #87D700 #87D75F #87D787 #87D7AF #87D7D7 #87D7FF #87FF00 #87FF5F #87FF87 #87FFAF #87FFD7 #87FFFF #AF0000 #AF005F #AF0087 #AF00AF #AF00D7 #AF00FF #AF5F00 #AF5F5F #AF5F87 #AF5FAF #AF5FD7 #AF5FFF #AF8700 #AF875F #AF8787 #AF87AF #AF87D7 #AF87FF #AFAF00 #AFAF5F #AFAF87 #AFAFAF #AFAFD7 #AFAFFF #AFD700 #AFD75F #AFD787 #AFD7AF #AFD7D7 #AFD7FF #AFFF00 #AFFF5F #AFFF87 #AFFFAF #AFFFD7 #AFFFFF #D70000 #D7005F #D70087 #D700AF #D700D7 #D700FF #D75F00 #D75F5F #D75F87 #D75FAF #D75FD7 #D75FFF #D78700 #D7875F #D78787 #D787AF #D787D7 #D787FF #D7AF00 #D7AF5F #D7AF87 #D7AFAF #D7AFD7 #D7AFFF #D7D700 #D7D75F #D7D787 #D7D7AF #D7D7D7 #D7D7FF #D7FF00 #D7FF5F #D7FF87 #D7FFAF #D7FFD7 #D7FFFF #FF0000 #FF005F #FF0087 #FF00AF #FF00D7 #FF00FF #FF5F00 #FF5F5F #FF5F87 #FF5FAF #FF5FD7 #FF5FFF #FF8700 #FF875F #FF8787 #FF87AF #FF87D7 #FF87FF #FFAF00 #FFAF5F #FFAF87 #FFAFAF #FFAFD7 #FFAFFF #FFD700 #FFD75F #FFD787 #FFD7AF #FFD7D7 #FFD7FF #FFFF00 #FFFF5F #FFFF87 #FFFFAF #FFFFD7 #FFFFFF #080808 #121212 #1C1C1C #262626 #303030 #3A3A3A #444444 #4E4E4E #585858 #626262 #6C6C6C #767676 #808080 #8A8A8A #949494 #9E9E9E #A8A8A8 #B2B2B2 #BCBCBC #C6C6C6 #D0D0D0 #DADADA #E4E4E4 #EEEEEE".split(" "));
lib.colors.colorNames={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",antiquewhite1:"rgb(255, 239, 219)",antiquewhite2:"rgb(238, 223, 204)",antiquewhite3:"rgb(205, 192, 176)",antiquewhite4:"rgb(139, 131, 120)",aquamarine:"rgb(127, 255, 212)",aquamarine1:"rgb(127, 255, 212)",aquamarine2:"rgb(118, 238, 198)",aquamarine3:"rgb(102, 205, 170)",aquamarine4:"rgb(69, 139, 116)",azure:"rgb(240, 255, 255)",azure1:"rgb(240, 255, 255)",azure2:"rgb(224, 238, 238)",azure3:"rgb(193, 205, 205)",
azure4:"rgb(131, 139, 139)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",bisque1:"rgb(255, 228, 196)",bisque2:"rgb(238, 213, 183)",bisque3:"rgb(205, 183, 158)",bisque4:"rgb(139, 125, 107)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blue1:"rgb(0, 0, 255)",blue2:"rgb(0, 0, 238)",blue3:"rgb(0, 0, 205)",blue4:"rgb(0, 0, 139)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",brown1:"rgb(255, 64, 64)",brown2:"rgb(238, 59, 59)",brown3:"rgb(205, 51, 51)",
brown4:"rgb(139, 35, 35)",burlywood:"rgb(222, 184, 135)",burlywood1:"rgb(255, 211, 155)",burlywood2:"rgb(238, 197, 145)",burlywood3:"rgb(205, 170, 125)",burlywood4:"rgb(139, 115, 85)",cadetblue:"rgb(95, 158, 160)",cadetblue1:"rgb(152, 245, 255)",cadetblue2:"rgb(142, 229, 238)",cadetblue3:"rgb(122, 197, 205)",cadetblue4:"rgb(83, 134, 139)",chartreuse:"rgb(127, 255, 0)",chartreuse1:"rgb(127, 255, 0)",chartreuse2:"rgb(118, 238, 0)",chartreuse3:"rgb(102, 205, 0)",chartreuse4:"rgb(69, 139, 0)",chocolate:"rgb(210, 105, 30)",
chocolate1:"rgb(255, 127, 36)",chocolate2:"rgb(238, 118, 33)",chocolate3:"rgb(205, 102, 29)",chocolate4:"rgb(139, 69, 19)",coral:"rgb(255, 127, 80)",coral1:"rgb(255, 114, 86)",coral2:"rgb(238, 106, 80)",coral3:"rgb(205, 91, 69)",coral4:"rgb(139, 62, 47)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",cornsilk1:"rgb(255, 248, 220)",cornsilk2:"rgb(238, 232, 205)",cornsilk3:"rgb(205, 200, 177)",cornsilk4:"rgb(139, 136, 120)",cyan:"rgb(0, 255, 255)",cyan1:"rgb(0, 255, 255)",cyan2:"rgb(0, 238, 238)",
cyan3:"rgb(0, 205, 205)",cyan4:"rgb(0, 139, 139)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgoldenrod1:"rgb(255, 185, 15)",darkgoldenrod2:"rgb(238, 173, 14)",darkgoldenrod3:"rgb(205, 149, 12)",darkgoldenrod4:"rgb(139, 101, 8)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkolivegreen1:"rgb(202, 255, 112)",darkolivegreen2:"rgb(188, 238, 104)",
darkolivegreen3:"rgb(162, 205, 90)",darkolivegreen4:"rgb(110, 139, 61)",darkorange:"rgb(255, 140, 0)",darkorange1:"rgb(255, 127, 0)",darkorange2:"rgb(238, 118, 0)",darkorange3:"rgb(205, 102, 0)",darkorange4:"rgb(139, 69, 0)",darkorchid:"rgb(153, 50, 204)",darkorchid1:"rgb(191, 62, 255)",darkorchid2:"rgb(178, 58, 238)",darkorchid3:"rgb(154, 50, 205)",darkorchid4:"rgb(104, 34, 139)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkseagreen1:"rgb(193, 255, 193)",
darkseagreen2:"rgb(180, 238, 180)",darkseagreen3:"rgb(155, 205, 155)",darkseagreen4:"rgb(105, 139, 105)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategray1:"rgb(151, 255, 255)",darkslategray2:"rgb(141, 238, 238)",darkslategray3:"rgb(121, 205, 205)",darkslategray4:"rgb(82, 139, 139)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",debianred:"rgb(215, 7, 81)",deeppink:"rgb(255, 20, 147)",deeppink1:"rgb(255, 20, 147)",deeppink2:"rgb(238, 18, 137)",
deeppink3:"rgb(205, 16, 118)",deeppink4:"rgb(139, 10, 80)",deepskyblue:"rgb(0, 191, 255)",deepskyblue1:"rgb(0, 191, 255)",deepskyblue2:"rgb(0, 178, 238)",deepskyblue3:"rgb(0, 154, 205)",deepskyblue4:"rgb(0, 104, 139)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",dodgerblue1:"rgb(30, 144, 255)",dodgerblue2:"rgb(28, 134, 238)",dodgerblue3:"rgb(24, 116, 205)",dodgerblue4:"rgb(16, 78, 139)",firebrick:"rgb(178, 34, 34)",firebrick1:"rgb(255, 48, 48)",firebrick2:"rgb(238, 44, 44)",
firebrick3:"rgb(205, 38, 38)",firebrick4:"rgb(139, 26, 26)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",gold1:"rgb(255, 215, 0)",gold2:"rgb(238, 201, 0)",gold3:"rgb(205, 173, 0)",gold4:"rgb(139, 117, 0)",goldenrod:"rgb(218, 165, 32)",goldenrod1:"rgb(255, 193, 37)",goldenrod2:"rgb(238, 180, 34)",goldenrod3:"rgb(205, 155, 29)",goldenrod4:"rgb(139, 105, 20)",gray:"rgb(190, 190, 190)",gray0:"rgb(0, 0, 0)",
gray1:"rgb(3, 3, 3)",gray10:"rgb(26, 26, 26)",gray100:"rgb(255, 255, 255)",gray11:"rgb(28, 28, 28)",gray12:"rgb(31, 31, 31)",gray13:"rgb(33, 33, 33)",gray14:"rgb(36, 36, 36)",gray15:"rgb(38, 38, 38)",gray16:"rgb(41, 41, 41)",gray17:"rgb(43, 43, 43)",gray18:"rgb(46, 46, 46)",gray19:"rgb(48, 48, 48)",gray2:"rgb(5, 5, 5)",gray20:"rgb(51, 51, 51)",gray21:"rgb(54, 54, 54)",gray22:"rgb(56, 56, 56)",gray23:"rgb(59, 59, 59)",gray24:"rgb(61, 61, 61)",gray25:"rgb(64, 64, 64)",gray26:"rgb(66, 66, 66)",gray27:"rgb(69, 69, 69)",
gray28:"rgb(71, 71, 71)",gray29:"rgb(74, 74, 74)",gray3:"rgb(8, 8, 8)",gray30:"rgb(77, 77, 77)",gray31:"rgb(79, 79, 79)",gray32:"rgb(82, 82, 82)",gray33:"rgb(84, 84, 84)",gray34:"rgb(87, 87, 87)",gray35:"rgb(89, 89, 89)",gray36:"rgb(92, 92, 92)",gray37:"rgb(94, 94, 94)",gray38:"rgb(97, 97, 97)",gray39:"rgb(99, 99, 99)",gray4:"rgb(10, 10, 10)",gray40:"rgb(102, 102, 102)",gray41:"rgb(105, 105, 105)",gray42:"rgb(107, 107, 107)",gray43:"rgb(110, 110, 110)",gray44:"rgb(112, 112, 112)",gray45:"rgb(115, 115, 115)",
gray46:"rgb(117, 117, 117)",gray47:"rgb(120, 120, 120)",gray48:"rgb(122, 122, 122)",gray49:"rgb(125, 125, 125)",gray5:"rgb(13, 13, 13)",gray50:"rgb(127, 127, 127)",gray51:"rgb(130, 130, 130)",gray52:"rgb(133, 133, 133)",gray53:"rgb(135, 135, 135)",gray54:"rgb(138, 138, 138)",gray55:"rgb(140, 140, 140)",gray56:"rgb(143, 143, 143)",gray57:"rgb(145, 145, 145)",gray58:"rgb(148, 148, 148)",gray59:"rgb(150, 150, 150)",gray6:"rgb(15, 15, 15)",gray60:"rgb(153, 153, 153)",gray61:"rgb(156, 156, 156)",gray62:"rgb(158, 158, 158)",
gray63:"rgb(161, 161, 161)",gray64:"rgb(163, 163, 163)",gray65:"rgb(166, 166, 166)",gray66:"rgb(168, 168, 168)",gray67:"rgb(171, 171, 171)",gray68:"rgb(173, 173, 173)",gray69:"rgb(176, 176, 176)",gray7:"rgb(18, 18, 18)",gray70:"rgb(179, 179, 179)",gray71:"rgb(181, 181, 181)",gray72:"rgb(184, 184, 184)",gray73:"rgb(186, 186, 186)",gray74:"rgb(189, 189, 189)",gray75:"rgb(191, 191, 191)",gray76:"rgb(194, 194, 194)",gray77:"rgb(196, 196, 196)",gray78:"rgb(199, 199, 199)",gray79:"rgb(201, 201, 201)",gray8:"rgb(20, 20, 20)",
gray80:"rgb(204, 204, 204)",gray81:"rgb(207, 207, 207)",gray82:"rgb(209, 209, 209)",gray83:"rgb(212, 212, 212)",gray84:"rgb(214, 214, 214)",gray85:"rgb(217, 217, 217)",gray86:"rgb(219, 219, 219)",gray87:"rgb(222, 222, 222)",gray88:"rgb(224, 224, 224)",gray89:"rgb(227, 227, 227)",gray9:"rgb(23, 23, 23)",gray90:"rgb(229, 229, 229)",gray91:"rgb(232, 232, 232)",gray92:"rgb(235, 235, 235)",gray93:"rgb(237, 237, 237)",gray94:"rgb(240, 240, 240)",gray95:"rgb(242, 242, 242)",gray96:"rgb(245, 245, 245)",gray97:"rgb(247, 247, 247)",
gray98:"rgb(250, 250, 250)",gray99:"rgb(252, 252, 252)",green:"rgb(0, 255, 0)",green1:"rgb(0, 255, 0)",green2:"rgb(0, 238, 0)",green3:"rgb(0, 205, 0)",green4:"rgb(0, 139, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(190, 190, 190)",grey0:"rgb(0, 0, 0)",grey1:"rgb(3, 3, 3)",grey10:"rgb(26, 26, 26)",grey100:"rgb(255, 255, 255)",grey11:"rgb(28, 28, 28)",grey12:"rgb(31, 31, 31)",grey13:"rgb(33, 33, 33)",grey14:"rgb(36, 36, 36)",grey15:"rgb(38, 38, 38)",grey16:"rgb(41, 41, 41)",grey17:"rgb(43, 43, 43)",
grey18:"rgb(46, 46, 46)",grey19:"rgb(48, 48, 48)",grey2:"rgb(5, 5, 5)",grey20:"rgb(51, 51, 51)",grey21:"rgb(54, 54, 54)",grey22:"rgb(56, 56, 56)",grey23:"rgb(59, 59, 59)",grey24:"rgb(61, 61, 61)",grey25:"rgb(64, 64, 64)",grey26:"rgb(66, 66, 66)",grey27:"rgb(69, 69, 69)",grey28:"rgb(71, 71, 71)",grey29:"rgb(74, 74, 74)",grey3:"rgb(8, 8, 8)",grey30:"rgb(77, 77, 77)",grey31:"rgb(79, 79, 79)",grey32:"rgb(82, 82, 82)",grey33:"rgb(84, 84, 84)",grey34:"rgb(87, 87, 87)",grey35:"rgb(89, 89, 89)",grey36:"rgb(92, 92, 92)",
grey37:"rgb(94, 94, 94)",grey38:"rgb(97, 97, 97)",grey39:"rgb(99, 99, 99)",grey4:"rgb(10, 10, 10)",grey40:"rgb(102, 102, 102)",grey41:"rgb(105, 105, 105)",grey42:"rgb(107, 107, 107)",grey43:"rgb(110, 110, 110)",grey44:"rgb(112, 112, 112)",grey45:"rgb(115, 115, 115)",grey46:"rgb(117, 117, 117)",grey47:"rgb(120, 120, 120)",grey48:"rgb(122, 122, 122)",grey49:"rgb(125, 125, 125)",grey5:"rgb(13, 13, 13)",grey50:"rgb(127, 127, 127)",grey51:"rgb(130, 130, 130)",grey52:"rgb(133, 133, 133)",grey53:"rgb(135, 135, 135)",
grey54:"rgb(138, 138, 138)",grey55:"rgb(140, 140, 140)",grey56:"rgb(143, 143, 143)",grey57:"rgb(145, 145, 145)",grey58:"rgb(148, 148, 148)",grey59:"rgb(150, 150, 150)",grey6:"rgb(15, 15, 15)",grey60:"rgb(153, 153, 153)",grey61:"rgb(156, 156, 156)",grey62:"rgb(158, 158, 158)",grey63:"rgb(161, 161, 161)",grey64:"rgb(163, 163, 163)",grey65:"rgb(166, 166, 166)",grey66:"rgb(168, 168, 168)",grey67:"rgb(171, 171, 171)",grey68:"rgb(173, 173, 173)",grey69:"rgb(176, 176, 176)",grey7:"rgb(18, 18, 18)",grey70:"rgb(179, 179, 179)",
grey71:"rgb(181, 181, 181)",grey72:"rgb(184, 184, 184)",grey73:"rgb(186, 186, 186)",grey74:"rgb(189, 189, 189)",grey75:"rgb(191, 191, 191)",grey76:"rgb(194, 194, 194)",grey77:"rgb(196, 196, 196)",grey78:"rgb(199, 199, 199)",grey79:"rgb(201, 201, 201)",grey8:"rgb(20, 20, 20)",grey80:"rgb(204, 204, 204)",grey81:"rgb(207, 207, 207)",grey82:"rgb(209, 209, 209)",grey83:"rgb(212, 212, 212)",grey84:"rgb(214, 214, 214)",grey85:"rgb(217, 217, 217)",grey86:"rgb(219, 219, 219)",grey87:"rgb(222, 222, 222)",grey88:"rgb(224, 224, 224)",
grey89:"rgb(227, 227, 227)",grey9:"rgb(23, 23, 23)",grey90:"rgb(229, 229, 229)",grey91:"rgb(232, 232, 232)",grey92:"rgb(235, 235, 235)",grey93:"rgb(237, 237, 237)",grey94:"rgb(240, 240, 240)",grey95:"rgb(242, 242, 242)",grey96:"rgb(245, 245, 245)",grey97:"rgb(247, 247, 247)",grey98:"rgb(250, 250, 250)",grey99:"rgb(252, 252, 252)",honeydew:"rgb(240, 255, 240)",honeydew1:"rgb(240, 255, 240)",honeydew2:"rgb(224, 238, 224)",honeydew3:"rgb(193, 205, 193)",honeydew4:"rgb(131, 139, 131)",hotpink:"rgb(255, 105, 180)",
hotpink1:"rgb(255, 110, 180)",hotpink2:"rgb(238, 106, 167)",hotpink3:"rgb(205, 96, 144)",hotpink4:"rgb(139, 58, 98)",indianred:"rgb(205, 92, 92)",indianred1:"rgb(255, 106, 106)",indianred2:"rgb(238, 99, 99)",indianred3:"rgb(205, 85, 85)",indianred4:"rgb(139, 58, 58)",ivory:"rgb(255, 255, 240)",ivory1:"rgb(255, 255, 240)",ivory2:"rgb(238, 238, 224)",ivory3:"rgb(205, 205, 193)",ivory4:"rgb(139, 139, 131)",khaki:"rgb(240, 230, 140)",khaki1:"rgb(255, 246, 143)",khaki2:"rgb(238, 230, 133)",khaki3:"rgb(205, 198, 115)",
khaki4:"rgb(139, 134, 78)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lavenderblush1:"rgb(255, 240, 245)",lavenderblush2:"rgb(238, 224, 229)",lavenderblush3:"rgb(205, 193, 197)",lavenderblush4:"rgb(139, 131, 134)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lemonchiffon1:"rgb(255, 250, 205)",lemonchiffon2:"rgb(238, 233, 191)",lemonchiffon3:"rgb(205, 201, 165)",lemonchiffon4:"rgb(139, 137, 112)",lightblue:"rgb(173, 216, 230)",lightblue1:"rgb(191, 239, 255)",
lightblue2:"rgb(178, 223, 238)",lightblue3:"rgb(154, 192, 205)",lightblue4:"rgb(104, 131, 139)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightcyan1:"rgb(224, 255, 255)",lightcyan2:"rgb(209, 238, 238)",lightcyan3:"rgb(180, 205, 205)",lightcyan4:"rgb(122, 139, 139)",lightgoldenrod:"rgb(238, 221, 130)",lightgoldenrod1:"rgb(255, 236, 139)",lightgoldenrod2:"rgb(238, 220, 130)",lightgoldenrod3:"rgb(205, 190, 112)",lightgoldenrod4:"rgb(139, 129, 76)",lightgoldenrodyellow:"rgb(250, 250, 210)",
lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightpink1:"rgb(255, 174, 185)",lightpink2:"rgb(238, 162, 173)",lightpink3:"rgb(205, 140, 149)",lightpink4:"rgb(139, 95, 101)",lightsalmon:"rgb(255, 160, 122)",lightsalmon1:"rgb(255, 160, 122)",lightsalmon2:"rgb(238, 149, 114)",lightsalmon3:"rgb(205, 129, 98)",lightsalmon4:"rgb(139, 87, 66)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightskyblue1:"rgb(176, 226, 255)",
lightskyblue2:"rgb(164, 211, 238)",lightskyblue3:"rgb(141, 182, 205)",lightskyblue4:"rgb(96, 123, 139)",lightslateblue:"rgb(132, 112, 255)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightsteelblue1:"rgb(202, 225, 255)",lightsteelblue2:"rgb(188, 210, 238)",lightsteelblue3:"rgb(162, 181, 205)",lightsteelblue4:"rgb(110, 123, 139)",lightyellow:"rgb(255, 255, 224)",lightyellow1:"rgb(255, 255, 224)",lightyellow2:"rgb(238, 238, 209)",lightyellow3:"rgb(205, 205, 180)",
lightyellow4:"rgb(139, 139, 122)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",magenta1:"rgb(255, 0, 255)",magenta2:"rgb(238, 0, 238)",magenta3:"rgb(205, 0, 205)",magenta4:"rgb(139, 0, 139)",maroon:"rgb(176, 48, 96)",maroon1:"rgb(255, 52, 179)",maroon2:"rgb(238, 48, 167)",maroon3:"rgb(205, 41, 144)",maroon4:"rgb(139, 28, 98)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumorchid1:"rgb(224, 102, 255)",mediumorchid2:"rgb(209, 95, 238)",
mediumorchid3:"rgb(180, 82, 205)",mediumorchid4:"rgb(122, 55, 139)",mediumpurple:"rgb(147, 112, 219)",mediumpurple1:"rgb(171, 130, 255)",mediumpurple2:"rgb(159, 121, 238)",mediumpurple3:"rgb(137, 104, 205)",mediumpurple4:"rgb(93, 71, 139)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",
mistyrose1:"rgb(255, 228, 225)",mistyrose2:"rgb(238, 213, 210)",mistyrose3:"rgb(205, 183, 181)",mistyrose4:"rgb(139, 125, 123)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navajowhite1:"rgb(255, 222, 173)",navajowhite2:"rgb(238, 207, 161)",navajowhite3:"rgb(205, 179, 139)",navajowhite4:"rgb(139, 121, 94)",navy:"rgb(0, 0, 128)",navyblue:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olivedrab:"rgb(107, 142, 35)",olivedrab1:"rgb(192, 255, 62)",olivedrab2:"rgb(179, 238, 58)",olivedrab3:"rgb(154, 205, 50)",
olivedrab4:"rgb(105, 139, 34)",orange:"rgb(255, 165, 0)",orange1:"rgb(255, 165, 0)",orange2:"rgb(238, 154, 0)",orange3:"rgb(205, 133, 0)",orange4:"rgb(139, 90, 0)",orangered:"rgb(255, 69, 0)",orangered1:"rgb(255, 69, 0)",orangered2:"rgb(238, 64, 0)",orangered3:"rgb(205, 55, 0)",orangered4:"rgb(139, 37, 0)",orchid:"rgb(218, 112, 214)",orchid1:"rgb(255, 131, 250)",orchid2:"rgb(238, 122, 233)",orchid3:"rgb(205, 105, 201)",orchid4:"rgb(139, 71, 137)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",
palegreen1:"rgb(154, 255, 154)",palegreen2:"rgb(144, 238, 144)",palegreen3:"rgb(124, 205, 124)",palegreen4:"rgb(84, 139, 84)",paleturquoise:"rgb(175, 238, 238)",paleturquoise1:"rgb(187, 255, 255)",paleturquoise2:"rgb(174, 238, 238)",paleturquoise3:"rgb(150, 205, 205)",paleturquoise4:"rgb(102, 139, 139)",palevioletred:"rgb(219, 112, 147)",palevioletred1:"rgb(255, 130, 171)",palevioletred2:"rgb(238, 121, 159)",palevioletred3:"rgb(205, 104, 137)",palevioletred4:"rgb(139, 71, 93)",papayawhip:"rgb(255, 239, 213)",
peachpuff:"rgb(255, 218, 185)",peachpuff1:"rgb(255, 218, 185)",peachpuff2:"rgb(238, 203, 173)",peachpuff3:"rgb(205, 175, 149)",peachpuff4:"rgb(139, 119, 101)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",pink1:"rgb(255, 181, 197)",pink2:"rgb(238, 169, 184)",pink3:"rgb(205, 145, 158)",pink4:"rgb(139, 99, 108)",plum:"rgb(221, 160, 221)",plum1:"rgb(255, 187, 255)",plum2:"rgb(238, 174, 238)",plum3:"rgb(205, 150, 205)",plum4:"rgb(139, 102, 139)",powderblue:"rgb(176, 224, 230)",purple:"rgb(160, 32, 240)",
purple1:"rgb(155, 48, 255)",purple2:"rgb(145, 44, 238)",purple3:"rgb(125, 38, 205)",purple4:"rgb(85, 26, 139)",red:"rgb(255, 0, 0)",red1:"rgb(255, 0, 0)",red2:"rgb(238, 0, 0)",red3:"rgb(205, 0, 0)",red4:"rgb(139, 0, 0)",rosybrown:"rgb(188, 143, 143)",rosybrown1:"rgb(255, 193, 193)",rosybrown2:"rgb(238, 180, 180)",rosybrown3:"rgb(205, 155, 155)",rosybrown4:"rgb(139, 105, 105)",royalblue:"rgb(65, 105, 225)",royalblue1:"rgb(72, 118, 255)",royalblue2:"rgb(67, 110, 238)",royalblue3:"rgb(58, 95, 205)",
royalblue4:"rgb(39, 64, 139)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",salmon1:"rgb(255, 140, 105)",salmon2:"rgb(238, 130, 98)",salmon3:"rgb(205, 112, 84)",salmon4:"rgb(139, 76, 57)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seagreen1:"rgb(84, 255, 159)",seagreen2:"rgb(78, 238, 148)",seagreen3:"rgb(67, 205, 128)",seagreen4:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",seashell1:"rgb(255, 245, 238)",seashell2:"rgb(238, 229, 222)",seashell3:"rgb(205, 197, 191)",
seashell4:"rgb(139, 134, 130)",sienna:"rgb(160, 82, 45)",sienna1:"rgb(255, 130, 71)",sienna2:"rgb(238, 121, 66)",sienna3:"rgb(205, 104, 57)",sienna4:"rgb(139, 71, 38)",skyblue:"rgb(135, 206, 235)",skyblue1:"rgb(135, 206, 255)",skyblue2:"rgb(126, 192, 238)",skyblue3:"rgb(108, 166, 205)",skyblue4:"rgb(74, 112, 139)",slateblue:"rgb(106, 90, 205)",slateblue1:"rgb(131, 111, 255)",slateblue2:"rgb(122, 103, 238)",slateblue3:"rgb(105, 89, 205)",slateblue4:"rgb(71, 60, 139)",slategray:"rgb(112, 128, 144)",
slategray1:"rgb(198, 226, 255)",slategray2:"rgb(185, 211, 238)",slategray3:"rgb(159, 182, 205)",slategray4:"rgb(108, 123, 139)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",snow1:"rgb(255, 250, 250)",snow2:"rgb(238, 233, 233)",snow3:"rgb(205, 201, 201)",snow4:"rgb(139, 137, 137)",springgreen:"rgb(0, 255, 127)",springgreen1:"rgb(0, 255, 127)",springgreen2:"rgb(0, 238, 118)",springgreen3:"rgb(0, 205, 102)",springgreen4:"rgb(0, 139, 69)",steelblue:"rgb(70, 130, 180)",steelblue1:"rgb(99, 184, 255)",
steelblue2:"rgb(92, 172, 238)",steelblue3:"rgb(79, 148, 205)",steelblue4:"rgb(54, 100, 139)",tan:"rgb(210, 180, 140)",tan1:"rgb(255, 165, 79)",tan2:"rgb(238, 154, 73)",tan3:"rgb(205, 133, 63)",tan4:"rgb(139, 90, 43)",thistle:"rgb(216, 191, 216)",thistle1:"rgb(255, 225, 255)",thistle2:"rgb(238, 210, 238)",thistle3:"rgb(205, 181, 205)",thistle4:"rgb(139, 123, 139)",tomato:"rgb(255, 99, 71)",tomato1:"rgb(255, 99, 71)",tomato2:"rgb(238, 92, 66)",tomato3:"rgb(205, 79, 57)",tomato4:"rgb(139, 54, 38)",turquoise:"rgb(64, 224, 208)",
turquoise1:"rgb(0, 245, 255)",turquoise2:"rgb(0, 229, 238)",turquoise3:"rgb(0, 197, 205)",turquoise4:"rgb(0, 134, 139)",violet:"rgb(238, 130, 238)",violetred:"rgb(208, 32, 144)",violetred1:"rgb(255, 62, 150)",violetred2:"rgb(238, 58, 140)",violetred3:"rgb(205, 50, 120)",violetred4:"rgb(139, 34, 82)",wheat:"rgb(245, 222, 179)",wheat1:"rgb(255, 231, 186)",wheat2:"rgb(238, 216, 174)",wheat3:"rgb(205, 186, 150)",wheat4:"rgb(139, 126, 102)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",
yellow1:"rgb(255, 255, 0)",yellow2:"rgb(238, 238, 0)",yellow3:"rgb(205, 205, 0)",yellow4:"rgb(139, 139, 0)",yellowgreen:"rgb(154, 205, 50)"};lib.f={};lib.f.replaceVars=function(a,b){return a.replace(/%([a-z]*)\(([^\)]+)\)/gi,function(a,e,f){if("undefined"==typeof b[f])throw"Unknown variable: "+f;a=b[f];if(e in lib.f.replaceVars.functions)a=lib.f.replaceVars.functions[e](a);else if(e)throw"Unknown escape function: "+e;return a})};lib.f.replaceVars.functions={encodeURI:encodeURI,encodeURIComponent:encodeURIComponent};
lib.f.getAcceptLanguages=function(a){chrome&&chrome.i18n?chrome.i18n.getAcceptLanguages(a):setTimeout(function(){a([navigator.language.replace(/-/g,"_")])},0)};lib.f.parseQuery=function(a){"?"==a.substr(0,1)&&(a=a.substr(1));for(var b={},a=a.split("&"),c=0;c<a.length;c++){var e=a[c].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return b};lib.f.getURL=function(a){return chrome&&chrome.extension&&chrome.extension.getURL?chrome.extension.getURL(a):a};
lib.f.clamp=function(a,b,c){return a<b?b:a>c?c:a};lib.f.lpad=function(a,b,c){a=String(a);for(c=c||" ";a.length<b;)a=c+a;return a};lib.f.zpad=function(a,b){return lib.f.lpad(a,b,"0")};lib.f.getWhitespace=function(a){if(0==a)return"";var b=this.getWhitespace;b.whitespace||(b.whitespace="          ");for(;a>b.whitespace.length;)b.whitespace+=b.whitespace;return b.whitespace.substr(0,a)};lib.rtdep("lib.getStack");lib.fs={};"function"==typeof addEventListener&&addEventListener("load",function(){lib.fs.installFileErrorToString()});lib.fs.log=function(a,b){return function(){var c=Array.apply(null,arguments);console.log(a+": "+c.join(", "));b&&b.call(null,arguments)}};lib.fs.err=function(a,b){return function(){var c=Array.apply(null,arguments);console.error(a+": "+c.join(", "),lib.getStack());b&&b.call(null,arguments)}};
lib.fs.installFileErrorToString=function(){FileError.prototype.toString=function(){return"[object FileError: "+lib.fs.getFileErrorMnemonic(this.code)+"]"}};lib.fs.getFileErrorMnemonic=function(a){for(var b in FileError)if(-1!=b.search(/_ERR$/)&&FileError[b]==a)return b;return a};
lib.fs.overwriteFile=function(a,b,c,e,f){function h(){lib.fs.getOrCreateFile(a,b,g,lib.fs.log("Error creating: "+b,f))}function g(a){a.createWriter(m,lib.fs.log("Error creating writer for: "+b,f))}function m(a){a.onwriteend=e;a.onerror=lib.fs.log("Error writing to: "+b,f);if(!(c instanceof Blob)){var g=new (window.BlobBuilder||window.WebKitBlobBuilder);g.append(c);c=g.getBlob("text/plain")}a.write(c)}a.getFile(b,{create:!1},function(a){a.remove(h,h)},h)};
lib.fs.readFile=function(a,b,c,e){a.getFile(b,{create:!1},function(a){a.file(function(a){var b=new FileReader;b.onloadend=function(){c(b.result)};b.readAsText(a)},e)},e)};lib.fs.removeFile=function(a,b,c,e){a.getFile(b,{},function(a){a.remove(lib.fs.log("Removed: "+b,c),lib.fs.err("Error removing"+b,e))},lib.fs.log("Error finding: "+b,e))};
lib.fs.readDirectory=function(a,b,c,e){var f={};a.getDirectory(b,{create:!1},function(a){a.createReader().readEntries(function(a){for(var b=0;b<a.length;b++)f[a[b].name]=a[b];c(f)},e)},e)};lib.fs.getOrCreateFile=function(a,b,c,e){function f(a){a.getFile(g,{create:!0},c,e)}var h=null,g=null,m=b.lastIndexOf("/");-1<m?(h=b.substr(0,m),g=b.substr(m+1)):g=b;if(!h)return f(a);lib.fs.getOrCreateDirectory(a,h,f,e)};
lib.fs.getOrCreateDirectory=function(a,b,c,e){function f(a){if(!h.length)return c(a);var b=h.shift();!b||"."==b?f(a):a.getDirectory(b,{create:!0},f,e)}var h=b.split("/");f(a)};lib.PreferenceManager=function(a,b,c){a=a||"";"/"!=a.substr(a.length-1)&&(a+="/");this.prefix_=a;this.storage_=b||window.localStorage;this.eventSource_=c||window;this.prefDefs_={};this.globalObservers_=[];this.pendingSets_={};this.eventSource_.addEventListener("storage",this.onStorageEvent_.bind(this),!1)};lib.PreferenceManager.prototype.definePreference=function(a,b,c){this.prefDefs_[a]={defaultValue:b,observers:c?[c]:[]}};
lib.PreferenceManager.prototype.definePreferences=function(a){for(var b=0;b<a.length;b++)this.definePreference(a[b][0],a[b][1],a[b][2])};lib.PreferenceManager.prototype.observePreferences=function(a,b){a&&this.globalObservers_.push(a);if(b)for(var c in b){if(!(c in this.prefDefs_))throw Error("Unknown preference: "+c);this.prefDefs_[c].observers.push(b[c])}};lib.PreferenceManager.prototype.notifyAll=function(){for(var a in this.prefDefs_)this.notifyChange_(a)};
lib.PreferenceManager.prototype.notifyChange_=function(a){for(var b=0;b<this.globalObservers_.length;b++)this.globalObservers_[b](a,this.get(a));for(var c=this.prefDefs_[a].observers,b=0;b<c.length;b++)c[b](this.get(a),a,this)};lib.PreferenceManager.prototype.reset=function(a){var b=this.get(a);this.storage_.removeItem(this.prefix_+a);b!=this.get(a)&&this.notifyChange_(a)};lib.PreferenceManager.prototype.resetAll=function(){for(var a in this.prefDefs_)this.reset(a)};
lib.PreferenceManager.prototype.set=function(a,b){if(!this.prefDefs_[a])throw Error("Request to set unknown pref: "+a);var c=this.get(a);this.storage_.setItem(this.prefix_+a,JSON.stringify(b));c!=this.get(a)&&this.notifyChange_(a)};lib.PreferenceManager.prototype.setLater=function(a,b,c){a in this.pendingSets_||setTimeout(function(){this.set(a,this.pendingSets_[a]);delete this.pendingSets_[a]}.bind(this),c||500);this.pendingSets_[a]=b};
lib.PreferenceManager.prototype.get=function(a){var b=this.storage_.getItem(this.prefix_+a);return null===b?(b=this.prefDefs_[a],!b?(console.warn("Request for unknown pref: "+a),null):b.defaultValue):JSON.parse(b)};lib.PreferenceManager.prototype.listKeys=function(a){for(var b=[],c=0;c<this.storage_.length;c++){var e=this.storage_.key(c);if(this.prefix_){if(e.substr(0,this.prefix_.length)!=this.prefix_)continue;e=e.substr(this.prefix_.length)}if(a){if(e.substr(0,a.length)!=a)continue;e=e.substr(a.length)}b.push(e)}return b.sort()};
lib.PreferenceManager.prototype.onStorageEvent_=function(a){if(a.storageArea==this.storage_){a=a.key;if(this.prefix_){if(a.substr(0,this.prefix_.length)!=this.prefix_)return;a=a.substr(this.prefix_.length)}a in this.prefDefs_&&this.notifyChange_(a)}};lib.rtdep("lib.fs");var hterm={init:function(a){a&&a()},msg:function(a,b){if(!chrome.i18n)return a;var c=chrome.i18n.getMessage(a,b);c||console.log("Missing message: "+a);return c},Size:function(a,b){this.width=a;this.height=b}};hterm.Size.prototype.resize=function(a,b){this.width=a;this.height=b};hterm.Size.prototype.clone=function(){return new hterm.Size(this.width,this.height)};hterm.Size.prototype.setTo=function(a){this.width=a.width;this.height=a.height};
hterm.Size.prototype.equals=function(a){return this.width==a.width&&this.height==a.height};hterm.Size.prototype.toString=function(){return"[hterm.Size: "+this.width+", "+this.height+"]"};hterm.RowCol=function(a,b,c){this.row=a;this.column=b;this.overflow=!!c};hterm.RowCol.prototype.move=function(a,b,c){this.row=a;this.column=b;this.overflow=!!c};hterm.RowCol.prototype.clone=function(){return new hterm.RowCol(this.row,this.column,this.overflow)};
hterm.RowCol.prototype.setTo=function(a){this.row=a.row;this.column=a.column;this.overflow=a.overflow};hterm.RowCol.prototype.equals=function(a){return this.row==a.row&&this.column==a.column&&this.overflow==a.overflow};hterm.RowCol.prototype.toString=function(){return"[hterm.RowCol: "+this.row+", "+this.column+", "+this.overflow+"]"};lib.rtdep("lib.f");hterm.Frame=function(a,b,c){this.terminal_=a;this.div_=a.div_;this.url=b;this.options=c||{};this.messageChannel_=this.container_=this.iframe_=null};hterm.Frame.prototype.onMessage_=function(a){"ipc-init-ok"!=a.data.name?console.log("Unknown message from frame:",a.data):(this.sendTerminalInfo_(),this.messageChannel_.port1.onmessage=this.onMessage.bind(this),this.onLoad())};hterm.Frame.prototype.onMessage=function(){};
hterm.Frame.prototype.onLoad_=function(){this.messageChannel_=new MessageChannel;this.messageChannel_.port1.onmessage=this.onMessage_.bind(this);this.messageChannel_.port1.start();this.iframe_.contentWindow.postMessage({name:"ipc-init",argv:[{messagePort:this.messageChannel_.port2}]},[this.messageChannel_.port2],this.url)};hterm.Frame.prototype.onLoad=function(){};
hterm.Frame.prototype.sendTerminalInfo_=function(){lib.f.getAcceptLanguages(function(a){this.postMessage("terminal-info",[{acceptLanguages:a,foregroundColor:this.terminal_.getForegroundColor(),backgroundColor:this.terminal_.getBackgroundColor(),cursorColor:this.terminal_.getCursorColor(),fontSize:this.terminal_.getFontSize(),fontFamily:this.terminal_.getFontFamily(),baseURL:lib.f.getURL("/")}])}.bind(this))};hterm.Frame.prototype.onCloseClicked_=function(){this.close()};
hterm.Frame.prototype.close=function(){this.container_&&this.container_.parentNode&&(this.container_.parentNode.removeChild(this.container_),this.onClose())};hterm.Frame.prototype.onClose=function(){};hterm.Frame.prototype.postMessage=function(a,b){if(!this.messageChannel_)throw Error("Message channel is not set up.");this.messageChannel_.port1.postMessage({name:a,argv:b})};
hterm.Frame.prototype.show=function(){var a=this,a=this;if(this.container_&&this.container_.parentNode)console.error("Frame already visible");else{var b="width"in a.options?a.options.width:640,a="height"in a.options?a.options.height:480,c=(this.div_.clientWidth-b)/2,e=(this.div_.clientHeight-a)/2,f=this.terminal_.document_,h=this.container_=f.createElement("div");h.style.cssText="position: absolute;top: "+e+"px;left: "+c+"px;width: "+b+"px;height: "+a+"px;box-shadow: 0 0 2px "+this.terminal_.getForegroundColor()+
";border: 2px "+this.terminal_.getForegroundColor()+" solid;";c=f.createElement("div");c.style.cssText="height: 16px;width: 100%;background-color: "+this.terminal_.getForegroundColor()+";color: "+this.terminal_.getBackgroundColor()+";font-size: 16px;font-family: "+this.terminal_.getFontFamily()+";text-align: right;";h.appendChild(c);e=f.createElement("div");e.setAttribute("role","button");e.style.cssText="margin-top: -3px;margin-right: 3px;float: right;cursor: pointer;";e.textContent="\u2a2f";e.addEventListener("click",
this.onCloseClicked_.bind(this));c.appendChild(e);f=this.iframe_=f.createElement("iframe");f.onload=this.onLoad_.bind(this);f.style.cssText="position: absolute;top: 16px;border-width: 0px;height: "+(a-16)+"px;width: "+b+"px;";f.setAttribute("src",this.url);h.appendChild(f);this.div_.appendChild(h)}};lib.rtdep("hterm.Keyboard.KeyMap");
hterm.Keyboard=function(a){this.terminal=a;this.keyboardElement_=null;this.handlers_=[["keypress",this.onKeyPress_.bind(this)],["keydown",this.onKeyDown_.bind(this)]];this.keyMap=new hterm.Keyboard.KeyMap(this);this.homeKeysScroll=a.prefs_.get("home-keys-scroll");this.pageKeysScroll=a.prefs_.get("page-keys-scroll");this.applicationCursor=this.applicationKeypad=!1;this.backspaceSendsBackspace=a.prefs_.get("backspace-sends-backspace");this.metaSendsEscape=a.prefs_.get("meta-sends-escape");this.altSendsWhat=
a.prefs_.get("alt-sends-what");this.altIsMeta=a.prefs_.get("alt-is-meta")};hterm.Keyboard.KeyActions={CANCEL:new String("CANCEL"),DEFAULT:new String("DEFAULT"),PASS:new String("PASS"),STRIP:new String("STRIP")};
hterm.Keyboard.prototype.installKeyboard=function(a){if(a!=this.keyboardElement_){a&&this.keyboardElement_&&this.installKeyboard(null);for(var b=0;b<this.handlers_.length;b++){var c=this.handlers_[b];a?a.addEventListener(c[0],c[1]):this.keyboardElement_.removeEventListener(c[0],c[1])}this.keyboardElement_=a}};hterm.Keyboard.prototype.uninstallKeyboard=function(){this.installKeyboard(null)};
hterm.Keyboard.prototype.onKeyPress_=function(a){if(a.altKey&&"browser-key"==this.altSendsWhat&&0==a.charCode){var b=String.fromCharCode(a.keyCode);a.shiftKey||(b=b.toLowerCase());b.charCodeAt(0)}else 32<=a.charCode&&(b=a.charCode);b&&(b=this.terminal.vt.encodeUTF8(String.fromCharCode(b)),this.terminal.onVTKeystroke(b));a.preventDefault();a.stopPropagation()};
hterm.Keyboard.prototype.onKeyDown_=function(a){function b(d){var f=c[d];"function"==typeof f&&(f=f.apply(e.keyMap,[a,c]));f===h&&"normal"!=d&&(f=b("normal"));return f}var c=this.keyMap.keyDefs[a.keyCode];if(c){var e=this,f=hterm.Keyboard.KeyActions.CANCEL,h=hterm.Keyboard.KeyActions.DEFAULT,g=hterm.Keyboard.KeyActions.PASS,m=hterm.Keyboard.KeyActions.STRIP,n=a.shiftKey,k=a.ctrlKey,d=this.altIsMeta?!1:a.altKey,i=this.altIsMeta?a.altKey||a.metaKey:a.metaKey,j;j=k?b("control"):d?b("alt"):i?b("meta"):
b("normal");d&&("browser-key"==this.altSendsWhat&&j==h)&&(j=g);if(!(j===g||j===h&&!k&&!d&&!i))if(j===m&&(d=k=!1,j=c.normal,"function"==typeof j&&(j=j.apply(this.keyMap,[a,c])),j==h&&2==c.keyCap.length&&(j=c.keyCap.substr(a.shiftKey?1:0,1))),a.preventDefault(),a.stopPropagation(),j!==f)if(j!==h&&"string"!=typeof j)console.warn("Invalid action: "+JSON.stringify(j));else{if("\u001b["!=j.substr(0,2)){if(j===h&&(k?(f=c.keyCap.substr(0,1).charCodeAt(0),64<=f&&95>=f&&(j=String.fromCharCode(f-64))):d&&"8-bit"==
this.altSendsWhat?(f=c.keyCap.substr(a.shiftKey?1:0,1).charCodeAt(0)+128,j=this.terminal.vt.encodeUTF8(String.fromCharCode(f))):j=c.keyCap.substr(a.shiftKey?1:0,1)),d&&"escape"==this.altSendsWhat||this.metaSendsEscape&&i)j="\u001b"+j}else if(d||k||n){var l;n&&!d&&!k?l=";2":d&&!n&&!k?l=";3":n&&d&&!k?l=";4":k&&!n&&!d?l=";5":n&&k&&!d?l=";6":d&&k&&!n?l=";7":n&&(d&&k)&&(l=";8");j=3==j.length?"\u001b[1"+l+j.substr(2,1):j.substr(0,j.length-2)+l+j.substr(j.length-1)}this.terminal.onVTKeystroke(j)}}else console.warn("No definition for keyCode: "+
a.keyCode)};lib.rtdep("hterm.Keyboard.KeyActions");hterm.Keyboard.KeyMap=function(a){this.keyboard=a;this.keyDefs={};this.reset()};hterm.Keyboard.KeyMap.prototype.addKeyDef=function(a,b){a in this.keyDefs&&console.warn("Duplicate keyCode: "+a);this.keyDefs[a]=b};hterm.Keyboard.KeyMap.prototype.addKeyDefs=function(a){for(var b=0;b<arguments.length;b++)this.addKeyDef(arguments[b][0],{keyCap:arguments[b][1],normal:arguments[b][2],control:arguments[b][3],alt:arguments[b][4],meta:arguments[b][5]})};
hterm.Keyboard.KeyMap.prototype={__proto__:hterm.Keyboard.KeyMap.prototype};
hterm.Keyboard.KeyMap.prototype.reset=function(){function a(a,b,c){return"function"==typeof a?a.apply(n,[b,c]):a}function b(b,c){return function(d,e){return a(d.shiftKey||d.ctrlKey||d.altKey||d.metaKey||!n.keyboard.applicationKeypad?b:c,d,e)}}function c(b,c){return function(d,e){return a(d.shiftKey||d.ctrlKey||d.altKey||d.metaKey||!n.keyboard.applicationCursor?b:c,d,e)}}function e(b,c){return function(d,e){return a(!n.keyboard.backspaceSendsBackspace?b:c,d,e)}}function f(b,c){return function(d,e){return a(!d.shiftKey?
b:c,d,e)}}function h(b,c){return function(d,e){return a(!d.shiftKey&&!d.ctrlKey&&!d.altKey&&!d.metaKey?b:c,d,e)}}function g(a){return String.fromCharCode(a.charCodeAt(0)-64)}function m(a){return function(b,c){return this[a](b,c)}}this.keyDefs={};var n=this,k=hterm.Keyboard.KeyActions.CANCEL,d=hterm.Keyboard.KeyActions.DEFAULT,i=hterm.Keyboard.KeyActions.PASS,j=hterm.Keyboard.KeyActions.STRIP,l=window.navigator.userAgent.match(/Mac OS X/),o=l?d:f(i,d),l=l?f(i,d):d;this.addKeyDefs([0,"[UNKNOWN]",i,
i,i,i],[27,"[ESC]","\u001b",d,d,d],[112,"[F1]",h("\u001bOP","\u001b[P"),d,d,d],[113,"[F2]",h("\u001bOQ","\u001b[Q"),d,d,d],[114,"[F3]",h("\u001bOR","\u001b[R"),d,d,d],[115,"[F4]",h("\u001bOS","\u001b[S"),d,d,d],[116,"[F5]","\u001b[15~",d,d,d],[117,"[F6]","\u001b[17~",d,d,d],[118,"[F7]","\u001b[18~",d,d,d],[119,"[F8]","\u001b[19~",d,d,d],[120,"[F9]","\u001b[20~",d,d,d],[121,"[F10]","\u001b[21~",d,d,d],[122,"[F11]","\u001b[23~",d,d,d],[123,"[F12]","\u001b[24~",d,d,d],[192,"`~",d,f(g("@"),g("^")),d,
i],[49,"1!",d,f(i,j),o,l],[50,"2@",d,f(i,g("@")),o,l],[51,"3#",d,f(i,g("[")),o,l],[52,"4$",d,f(i,g("\\")),o,l],[53,"5%",d,f(i,g("]")),o,l],[54,"6^",d,f(i,g("^")),o,l],[55,"7&",d,f(i,g("_")),o,l],[56,"8*",d,f(i,"*"),o,l],[57,"9(",d,f(i,j),o,l],[48,"0)",d,m("onZoom_"),d,d],[189,"-_",d,f(m("onZoom_"),g("_")),d,d],[187,"=+",d,m("onZoom_"),d,d],[8,"[BKSP]",e("\u007f","\b"),e("\b","\u007f"),d,d],[9,"[TAB]","\t",j,i,d],[81,"qQ",d,g("Q"),d,d],[87,"wW",d,g("W"),d,d],[69,"eE",d,g("E"),d,d],[82,"rR",d,g("R"),
d,d],[84,"tT",d,g("T"),d,d],[89,"yY",d,g("Y"),d,d],[85,"uU",d,g("U"),d,d],[73,"iI",d,g("I"),d,d],[79,"oO",d,g("O"),d,d],[80,"pP",d,g("P"),d,d],[219,"[{",d,g("["),d,d],[221,"]}",d,g("]"),d,d],[220,"\\|",d,g("\\"),d,d],[20,"[CAPS]",i,i,i,d],[65,"aA",d,g("A"),d,d],[83,"sS",d,g("S"),d,d],[68,"dD",d,g("D"),d,d],[70,"fF",d,g("F"),d,d],[71,"gG",d,g("G"),d,d],[72,"hH",d,g("H"),d,d],[74,"jJ",d,f(g("J"),i),d,d],[75,"kK",d,g("K"),d,d],[76,"lL",d,g("L"),d,d],[186,";:",d,j,d,d],[222,"'\"",d,j,d,d],[13,"[ENTER]",
"\r",k,k,d],[16,"[SHIFT]",i,i,i,d],[90,"zZ",d,g("Z"),d,d],[88,"xX",d,g("X"),d,d],[67,"cC",d,m("onCtrlC_"),d,m("onMetaC_")],[86,"vV",d,f(g("V"),i),d,i],[66,"bB",d,f(g("B"),i),d,f(d,i)],[78,"nN",d,g("N"),d,d],[77,"mM",d,g("M"),d,d],[188,",<",d,j,d,d],[190,".>",d,j,d,d],[191,"/?",d,f(g("_"),g("?")),d,d],[17,"[CTRL]",i,i,i,i],[18,"[ALT]",i,i,i,i],[91,"[LAPL]",i,i,i,i],[32," ",d,g("@"),d,d],[92,"[RAPL]",i,i,i,i],[42,"[PRTSCR]",i,i,i,i],[145,"[SCRLK]",i,i,i,i],[19,"[BREAK]",i,i,i,i],[45,"[INSERT]","\u001b[2~",
d,d,d],[36,"[HOME]",m("onKeyHome_"),d,d,d],[33,"[PGUP]",m("onKeyPageUp_"),d,d,d],[46,"[DEL]","\u001b[3~",d,d,d],[35,"[END]",m("onKeyEnd_"),d,d,d],[34,"[PGDOWN]",m("onKeyPageDown_"),d,d,d],[38,"[UP]",c("\u001b[A","\u001bOA"),d,d,d],[40,"[DOWN]",c("\u001b[B","\u001bOB"),d,d,d],[39,"[RIGHT]",c("\u001b[C","\u001bOC"),d,d,d],[37,"[LEFT]",c("\u001b[D","\u001bOD"),d,d,d],[144,"[NUMLOCK]",i,i,i,i],[96,"[KP0]",b(d,"\u001b[2~"),d,d,d],[97,"[KP1]",b(d,"\u001bOF"),d,d,d],[98,"[KP2]",b(d,"\u001b[B"),d,d,d],[99,
"[KP3]",b(d,"\u001b[6~"),d,d,d],[100,"[KP4]",b(d,"\u001b[D"),d,d,d],[101,"[KP5]",b(d,"\u001b[E"),d,d,d],[102,"[KP6]",b(d,"\u001b[C"),d,d,d],[103,"[KP7]",b(d,"\u001bOH"),d,d,d],[104,"[KP8]",b(d,"\u001b[A"),d,d,d],[105,"[KP9]",b(d,"\u001b[5~"),d,d,d],[107,"[KP+]",b(d,"\u001bOk"),d,d,d],[109,"[KP-]",b(d,"\u001bOm"),d,d,d],[106,"[KP*]",b(d,"\u001bOj"),d,d,d],[111,"[KP/]",b(d,"\u001bOo"),d,d,d],[110,"[KP.]",b(d,"\u001b[3~"),d,d,d])};
hterm.Keyboard.KeyMap.prototype.onKeyHome_=function(a){if(!this.keyboard.homeKeysScroll^a.shiftKey)return a.altey||(a.ctrlKey||a.shiftKey)||!this.keyboard.applicationKeypad?"\u001b[H":"\u001bOH";this.keyboard.terminal.scrollHome();return hterm.Keyboard.KeyActions.CANCEL};
hterm.Keyboard.KeyMap.prototype.onKeyEnd_=function(a){if(!this.keyboard.homeKeysScroll^a.shiftKey)return a.altKey||(a.ctrlKey||a.shiftKey)||!this.keyboard.applicationKeypad?"\u001b[F":"\u001bOF";this.keyboard.terminal.scrollEnd();return hterm.Keyboard.KeyActions.CANCEL};hterm.Keyboard.KeyMap.prototype.onKeyPageUp_=function(a){if(!this.keyboard.pageKeysScroll^a.shiftKey)return"\u001b[5~";this.keyboard.terminal.scrollPageUp();return hterm.Keyboard.KeyActions.CANCEL};
hterm.Keyboard.KeyMap.prototype.onKeyPageDown_=function(a){if(!this.keyboard.pageKeysScroll^a.shiftKey)return"\u001b[6~";this.keyboard.terminal.scrollPageDown();return hterm.Keyboard.KeyActions.CANCEL};hterm.Keyboard.KeyMap.prototype.onCtrlC_=function(a){var b=this.keyboard.terminal.getDocument();if(a.shiftKey||b.getSelection().isCollapsed)return"\u0003";setTimeout(function(){b.getSelection().collapseToEnd()},50);return hterm.Keyboard.KeyActions.PASS};
hterm.Keyboard.KeyMap.prototype.onMetaC_=function(a,b){var c=this.keyboard.terminal.getDocument();if(a.shiftKey||c.getSelection().isCollapsed)return b.keyCap.substr(a.shiftKey?1:0,1);setTimeout(function(){c.getSelection().collapseToEnd()},50);return hterm.Keyboard.KeyActions.PASS};
hterm.Keyboard.KeyMap.prototype.onZoom_=function(a,b){if(1!=this.keyboard.terminal.getZoomFactor())return hterm.Keyboard.KeyActions.PASS;var c=b.keyCap.substr(0,1);if("0"==c)this.keyboard.terminal.setFontSize(0);else{var e=this.keyboard.terminal.getFontSize();this.keyboard.terminal.setFontSize("-"==c?e-1:e+1)}return hterm.Keyboard.KeyActions.CANCEL};hterm.Options=function(a){this.wraparound=a?a.wraparound:!0;this.reverseWraparound=a?a.reverseWraparound:!1;this.originMode=a?a.originMode:!1;this.autoCarriageReturn=a?a.autoCarriageReturn:!1;this.cursorVisible=a?a.cursorVisible:!1;this.cursorBlink=a?a.cursorBlink:!1;this.insertMode=a?a.insertMode:!1;this.reverseVideo=a?a.reverseVideo:!1};hterm.PubSub=function(){this.observers_={}};hterm.PubSub.addBehavior=function(a){var b=new hterm.PubSub,c;for(c in hterm.PubSub.prototype)a[c]=hterm.PubSub.prototype[c].bind(b)};hterm.PubSub.prototype.subscribe=function(a,b){a in this.observers_||(this.observers_[a]=[]);this.observers_[a].push(b)};hterm.PubSub.prototype.unsubscribe=function(a,b){var c=this.observers_[a];if(!c)throw"Invalid subject: "+a;var e=c.indexOf(b);if(0>e)throw"Not subscribed: "+a;c.splice(e,1)};
hterm.PubSub.prototype.publish=function(a,b,c){function e(a){a<f.length-1&&setTimeout(e,0,a+1);f[a](b)}var f=this.observers_[a];f&&(f=[].concat(f));c&&(f?f.push(c):f=[c]);f&&setTimeout(e,0,0)};lib.rtdep("lib.f","hterm.RowCol","hterm.Size","hterm.TextAttributes");hterm.Screen=function(a){this.rowsArray=[];this.columnCount_=a||80;this.textAttributes=new hterm.TextAttributes(window.document);this.cursorPosition=new hterm.RowCol(0,0);this.cursorOffset_=this.cursorNode_=this.cursorRowNode_=null};hterm.Screen.prototype.getSize=function(){return new hterm.Size(this.columnCount_,this.rowsArray.length)};hterm.Screen.prototype.getHeight=function(){return this.rowsArray.length};
hterm.Screen.prototype.getWidth=function(){return this.columnCount_};hterm.Screen.prototype.setColumnCount=function(a){this.columnCount_=a;this.cursorPosition.column>=a&&this.setCursorPosition(this.cursorPosition.row,a-1)};hterm.Screen.prototype.shiftRow=function(){return this.shiftRows(1)[0]};hterm.Screen.prototype.shiftRows=function(a){return this.rowsArray.splice(0,a)};hterm.Screen.prototype.unshiftRow=function(a){this.rowsArray.splice(0,0,a)};
hterm.Screen.prototype.unshiftRows=function(a){this.rowsArray.unshift.apply(this.rowsArray,a)};hterm.Screen.prototype.popRow=function(){return this.popRows(1)[0]};hterm.Screen.prototype.popRows=function(a){return this.rowsArray.splice(this.rowsArray.length-a,a)};hterm.Screen.prototype.pushRow=function(a){this.rowsArray.push(a)};hterm.Screen.prototype.pushRows=function(a){a.push.apply(this.rowsArray,a)};hterm.Screen.prototype.insertRow=function(a,b){this.rowsArray.splice(a,0,b)};
hterm.Screen.prototype.insertRows=function(a,b){for(var c=0;c<b.length;c++)this.rowsArray.splice(a+c,0,b[c])};hterm.Screen.prototype.removeRow=function(a){return this.rowsArray.splice(a,1)[0]};hterm.Screen.prototype.removeRows=function(a,b){return this.rowsArray.splice(a,b)};hterm.Screen.prototype.invalidateCursorPosition=function(){this.cursorPosition.move(0,0);this.cursorOffset_=this.cursorNode_=this.cursorRowNode_=null};
hterm.Screen.prototype.clearRow=function(a){a==this.cursorPosition.row?this.clearCursorRow():(a=this.rowsArray[a],a.innerHTML="",a.appendChild(a.ownerDocument.createTextNode("")))};hterm.Screen.prototype.clearCursorRow=function(){this.cursorRowNode_.innerHTML="";var a=this.cursorRowNode_.ownerDocument.createTextNode("");this.cursorRowNode_.appendChild(a);this.cursorOffset_=0;this.cursorNode_=a;this.cursorPosition.column=0;this.cursorPosition.overflow=!1};
hterm.Screen.prototype.setCursorPosition=function(a,b){if(this.rowsArray.length){a>=this.rowsArray.length?(console.error("Row out of bounds: "+a),a=this.rowsArray.length-1):0>a&&(console.error("Row out of bounds: "+a),a=0);b>=this.columnCount_?(console.error("Column out of bounds: "+b),b=this.columnCount_-1):0>b&&(console.error("Column out of bounds: "+b),b=0);this.cursorPosition.overflow=!1;var c=this.rowsArray[a],e=c.firstChild;e||(e=c.ownerDocument.createTextNode(""),c.appendChild(e));var f=0;
c==this.cursorRowNode_?b>=this.cursorPosition.column-this.cursorOffset_&&(e=this.cursorNode_,f=this.cursorPosition.column-this.cursorOffset_):this.cursorRowNode_=c;for(this.cursorPosition.move(a,b);e;){var c=b-f,h=e.textContent;if(!e.nextSibling||h.length>c){this.cursorNode_=e;this.cursorOffset_=c;break}f+=h.length;e=e.nextSibling}}else console.warn("Attempt to set cursor position on empty screen.")};hterm.Screen.prototype.syncSelectionCaret=function(a){a.collapse(this.cursorNode_,this.cursorOffset_)};
hterm.Screen.prototype.splitNode_=function(a,b){var c=a.cloneNode(!1),e=a.textContent;a.textContent=e.substr(0,b);c.textContent=e.substr(b);a.parentNode.insertBefore(c,a.nextSibling)};
hterm.Screen.prototype.clipAtCursor_=function(){this.cursorOffset_<this.cursorNode_.textContent.length-1&&this.splitNode_(this.cursorNode_,this.cursorOffset_+1);for(var a=null,b=this.cursorRowNode_,c=this.cursorNode_.nextSibling;c;){var e=c.textContent.length;e&&(a?(a.push(c),a.characterLength+=e):(a=[c],a.characterLength=e));b.removeChild(c);c=this.cursorNode_.nextSibling}return a};
hterm.Screen.prototype.maybeClipCurrentRow=function(){var a=this.cursorPosition.column;if(a>=this.columnCount_)return this.deleteChars(this.cursorRowNode_.textContent.length),this.setCursorPosition(this.cursorPosition.row,this.columnCount_-1),this.cursorPosition.overflow=!0,this.clipAtCursor_();this.cursorRowNode_.textContent.length>this.columnCount_&&(this.setCursorPosition(this.cursorPosition.row,this.columnCount_-1),this.clipAtCursor_(),this.setCursorPosition(this.cursorPosition.row,a));return null};
hterm.Screen.prototype.insertString=function(a){var b=this.cursorNode_,c=b.textContent,e=a.length;this.cursorPosition.column+=e;var f=this.cursorOffset_,h=c.length-f;if(0>h){var g=lib.f.getWhitespace(-h);!this.textAttributes.underline&&!this.textAttributes.background?a=g+a:3==b.nodeType||!b.style.textDecoration&&!b.style.backgroundColor?b.textContent=c+=g:(c=b.ownerDocument.createTextNode(g),this.cursorRowNode_.insertBefore(c,b.nextSibling),this.cursorNode_=b=c,this.cursorOffset_=f=-h,c=g);h=0}this.textAttributes.matchesContainer(b)?
(b.textContent=0==h?c+a:0==f?a+c:c.substr(0,f)+a+c.substr(f),this.cursorOffset_+=e):0==f?(h=b.previousSibling)&&this.textAttributes.matchesContainer(h)?(h.textContent+=a,this.cursorNode_=h,this.cursorOffset_=h.textContent.length):(h=this.textAttributes.createContainer(a),this.cursorRowNode_.insertBefore(h,b),this.cursorNode_=h,this.cursorOffset_=e):0==h?(b=b.nextSibling)&&this.textAttributes.matchesContainer(b)?(b.textContent=a+b.textContent,this.cursorNode_=b,this.cursorOffset_=e):(h=this.textAttributes.createContainer(a),
this.cursorRowNode_.insertBefore(h,b),this.cursorNode_=h,this.cursorOffset_=a.length):(this.splitNode_(b,f),h=this.textAttributes.createContainer(a),this.cursorRowNode_.insertBefore(h,b.nextSibling),this.cursorNode_=h,this.cursorOffset_=e)};hterm.Screen.prototype.prependNodes=function(a){for(var b=this.cursorRowNode_,c=a.length-1;0<=c;c--)b.insertBefore(a[c],b.firstChild);this.cursorPosition.column=0;this.cursorNode_=b.firstChild;this.cursorOffset_=0};
hterm.Screen.prototype.overwriteString=function(a){var b=this.columnCount_-this.cursorPosition.column;if(!b)return[a];this.cursorNode_.textContent.substr(this.cursorOffset_)==a&&this.textAttributes.matchesContainer(this.cursorNode_)?(this.cursorOffset_+=a.length,this.cursorPosition.column+=a.length):(this.deleteChars(Math.min(a.length,b)),this.insertString(a))};
hterm.Screen.prototype.deleteChars=function(a){var b=this.cursorNode_,c=this.cursorOffset_,e=b.textContent;if(!(e.length<=c)||b.nextSibling)for(;b&&a;){var f=e.length,e=e.substr(0,c)+e.substr(c+a),c=e.length,a=a-(f-c);b.textContent=e;0==c&&b!=this.cursorNode_?(f=b.nextSibling,b.parentNode.removeChild(b),b=f):b=b.nextSibling;b&&(e=b.textContent);c=0}};lib.rtdep("hterm.PubSub","hterm.Size");hterm.ScrollPort=function(a){hterm.PubSub.addBehavior(this);this.rowProvider_=a;this.characterSize=new hterm.Size(10,10);this.ruler_=null;this.selection_=new hterm.ScrollPort.Selection(this);this.currentRowNodeCache_=null;this.previousRowNodeCache_={};this.document_=this.div_=this.xrowCssRule_=this.lastScreenHeight_=this.lastScreenWidth_=null;this.timeouts_={};this.observers_={};this.DEBUG_=!1};
hterm.ScrollPort.Selection=function(a){this.scrollPort_=a;this.isCollapsed=this.isMultiline=this.endRow=this.startRow=this.selection_=null};
hterm.ScrollPort.Selection.prototype.sync=function(){var a=this.scrollPort_.getDocument().getSelection();this.isMultiline=this.endRow=this.startRow=null;this.isCollapsed=!a||a.isCollapsed;if(!this.isCollapsed){for(var b=a.anchorNode;b&&!("rowIndex"in b);)b=b.parentNode;if(b){for(var c=a.focusNode;c&&!("rowIndex"in c);)c=c.parentNode;c?(b.rowIndex<=c.rowIndex?(this.startRow=b,this.endRow=c):(this.startRow=c,this.endRow=b),this.isMultiline=b.rowIndex!=c.rowIndex):console.log("Selection focus is not rooted in a row node: "+
a.focusNode.nodeName)}else console.log("Selection anchor is not rooted in a row node: "+a.anchorNode.nodeName)}};
hterm.ScrollPort.prototype.decorate=function(a){this.div_=a;this.iframe_=a.ownerDocument.createElement("iframe");this.iframe_.style.cssText="border: 0;height: 100%;position: absolute;width: 100%";a.appendChild(this.iframe_);this.iframe_.contentWindow.addEventListener("resize",this.onResize_.bind(this));a=this.document_=this.iframe_.contentDocument;a.body.style.cssText="margin: 0px;padding: 0px;height: 100%;width: 100%;overflow: hidden;-webkit-user-select: none;";var b=a.createElement("style");b.textContent=
"x-row {}";a.head.appendChild(b);this.xrowCssRule_=a.styleSheets[0].cssRules[0];this.xrowCssRule_.style.display="block";this.screen_=a.createElement("x-screen");this.screen_.setAttribute("role","textbox");this.screen_.setAttribute("tabindex","-1");this.screen_.style.cssText="display: block;font-family: monospace;font-size: 15px;height: 100%;overflow-y: scroll; overflow-x: hidden;white-space: pre;width: 100%;outline: none !important";a.body.appendChild(this.screen_);this.screen_.addEventListener("scroll",
this.onScroll_.bind(this));this.screen_.addEventListener("mousewheel",this.onScrollWheel_.bind(this));this.screen_.addEventListener("copy",this.onCopy_.bind(this));this.screen_.addEventListener("paste",this.onPaste_.bind(this));this.pasteTarget_=a.createElement("textarea");this.pasteTarget_.setAttribute("tabindex","-1");this.pasteTarget_.style.cssText="position: absolute;top: -999px;";a.body.appendChild(this.pasteTarget_);this.rowNodes_=a.createElement("div");this.rowNodes_.style.cssText="display: block;position: fixed;overflow: hidden;-webkit-user-select: text;";
this.screen_.appendChild(this.rowNodes_);this.topSelectBag_=a.createElement("x-select-bag");this.topSelectBag_.style.cssText="display: block;overflow: hidden;white-space: pre;";this.bottomSelectBag_=this.topSelectBag_.cloneNode();this.topFold_=a.createElement("x-fold");this.topFold_.style.cssText="display: block;";this.rowNodes_.appendChild(this.topFold_);this.bottomFold_=this.topFold_.cloneNode();this.rowNodes_.appendChild(this.bottomFold_);this.scrollArea_=a.createElement("div");this.scrollArea_.style.cssText=
"visibility: hidden";this.screen_.appendChild(this.scrollArea_);this.resize()};hterm.ScrollPort.prototype.setFontFamily=function(a,b){this.screen_.style.fontFamily=a;this.screen_.style.webkitFontSmoothing=b?b:"";this.syncCharacterSize()};hterm.ScrollPort.prototype.getFontFamily=function(){return this.screen_.style.fontFamily};hterm.ScrollPort.prototype.focus=function(){this.iframe_.focus();this.screen_.focus()};hterm.ScrollPort.prototype.getForegroundColor=function(){return this.screen_.style.color};
hterm.ScrollPort.prototype.setForegroundColor=function(a){this.screen_.style.color=a};hterm.ScrollPort.prototype.getBackgroundColor=function(){return this.screen_.style.backgroundColor};hterm.ScrollPort.prototype.setBackgroundColor=function(a){this.screen_.style.backgroundColor=a};hterm.ScrollPort.prototype.setBackgroundImage=function(a){this.screen_.style.backgroundImage=a};hterm.ScrollPort.prototype.setBackgroundSize=function(a){this.screen_.style.backgroundSize=a};
hterm.ScrollPort.prototype.setBackgroundPosition=function(a){this.screen_.style.backgroundPosition=a};hterm.ScrollPort.prototype.getScreenWidth=function(){return this.screen_.clientWidth};hterm.ScrollPort.prototype.getScreenHeight=function(){return this.screen_.clientHeight};hterm.ScrollPort.prototype.getDocument=function(){return this.document_};hterm.ScrollPort.prototype.resetCache=function(){this.currentRowNodeCache_=null;this.previousRowNodeCache_={}};
hterm.ScrollPort.prototype.setRowProvider=function(a){this.resetCache();this.rowProvider_=a;this.scheduleRedraw()};hterm.ScrollPort.prototype.invalidate=function(){for(var a=this.topFold_.nextSibling;a!=this.bottomFold_;){var b=a.nextSibling;a.parentElement.removeChild(a);a=b}this.previousRowNodeCache_=null;a=this.getTopRowIndex();b=this.getBottomRowIndex(a);this.drawVisibleRows_(a,b)};
hterm.ScrollPort.prototype.scheduleInvalidate=function(){if(!this.timeouts_.invalidate){var a=this;this.timeouts_.invalidate=setTimeout(function(){delete a.timeouts_.invalidate;a.invalidate()},0)}};hterm.ScrollPort.prototype.setFontSize=function(a){this.screen_.style.fontSize=a+"px";this.syncCharacterSize()};hterm.ScrollPort.prototype.getFontSize=function(){return parseInt(this.screen_.style.fontSize)};
hterm.ScrollPort.prototype.measureCharacterSize=function(a){this.ruler_||(this.ruler_=this.document_.createElement("div"),this.ruler_.style.cssText="position: absolute;top: 0;left: 0;visibility: hidden;height: auto !important;width: auto !important;",this.ruler_.textContent="X");this.ruler_.style.fontWeight=a||"";this.rowNodes_.appendChild(this.ruler_);a=new hterm.Size(this.ruler_.clientWidth,this.ruler_.clientHeight+1);this.ruler_.style.webkitTextSizeAdjust="none";a.zoomFactor=a.width/this.ruler_.clientWidth;
this.ruler_.style.webkitTextSizeAdjust="";this.rowNodes_.removeChild(this.ruler_);return a};hterm.ScrollPort.prototype.syncCharacterSize=function(){this.characterSize=this.measureCharacterSize();var a=this.characterSize.height+"px";this.xrowCssRule_.style.height=a;this.topSelectBag_.style.height=a;this.bottomSelectBag_.style.height=a;this.resize();this.DEBUG_&&(this.document_.body.style.paddingTop=this.document_.body.style.paddingBottom=3*this.characterSize.height+"px")};
hterm.ScrollPort.prototype.resize=function(){var a=this.screen_.clientWidth,b=this.screen_.clientHeight;this.lastScreenWidth_=a;this.lastScreenHeight_=b;this.syncScrollHeight();this.visibleRowCount=Math.floor(b/this.characterSize.height);var c=this.visibleRowCount*this.characterSize.height;this.visibleRowTopMargin=0;this.visibleRowBottomMargin=b-c;this.topFold_.style.marginBottom=this.visibleRowTopMargin+"px";this.rowNodes_.style.width=a+"px";this.rowNodes_.style.height=c+"px";this.rowNodes_.style.left=
this.screen_.offsetLeft+"px";var e=this;this.publish("resize",{scrollPort:this},function(){e.scrollRowToBottom(e.rowProvider_.getRowCount());e.scheduleRedraw()})};hterm.ScrollPort.prototype.syncScrollHeight=function(){this.scrollArea_.style.height=this.characterSize.height*this.rowProvider_.getRowCount()+this.visibleRowTopMargin+this.visibleRowBottomMargin+"px"};
hterm.ScrollPort.prototype.scheduleRedraw=function(){if(!this.timeouts_.redraw){var a=this;this.timeouts_.redraw=setTimeout(function(){delete a.timeouts_.redraw;a.redraw_()},0)}};
hterm.ScrollPort.prototype.redraw_=function(){this.resetSelectBags_();this.selection_.sync();this.syncScrollHeight();this.currentRowNodeCache_={};var a=this.getTopRowIndex(),b=this.getBottomRowIndex(a);this.drawTopFold_(a);this.drawBottomFold_(b);this.drawVisibleRows_(a,b);this.syncRowNodesTop_();this.previousRowNodeCache_=this.currentRowNodeCache_;this.currentRowNodeCache_=null};
hterm.ScrollPort.prototype.drawTopFold_=function(a){if(!this.selection_.startRow||this.selection_.startRow.rowIndex>=a)this.rowNodes_.firstChild!=this.topFold_&&this.rowNodes_.insertBefore(this.topFold_,this.rowNodes_.firstChild);else{if(!this.selection_.isMultiline||this.selection_.endRow.rowIndex>=a)this.selection_.startRow.nextSibling!=this.topFold_&&this.rowNodes_.insertBefore(this.topFold_,this.selection_.startRow.nextSibling);else for(this.selection_.endRow.nextSibling!=this.topFold_&&this.rowNodes_.insertBefore(this.topFold_,
this.selection_.endRow.nextSibling);this.selection_.startRow.nextSibling!=this.selection_.endRow;)this.rowNodes_.removeChild(this.selection_.startRow.nextSibling);for(;this.rowNodes_.firstChild!=this.selection_.startRow;)this.rowNodes_.removeChild(this.rowNodes_.firstChild)}};
hterm.ScrollPort.prototype.drawBottomFold_=function(a){if(!this.selection_.endRow||this.selection_.endRow.rowIndex<=a)this.rowNodes_.lastChild!=this.bottomFold_&&this.rowNodes_.appendChild(this.bottomFold_);else{if(!this.selection_.isMultiline||this.selection_.startRow.rowIndex<=a)this.bottomFold_.nextSibling!=this.selection_.endRow&&this.rowNodes_.insertBefore(this.bottomFold_,this.selection_.endRow);else for(this.bottomFold_.nextSibling!=this.selection_.startRow&&this.rowNodes_.insertBefore(this.bottomFold_,
this.selection_.startRow);this.selection_.startRow.nextSibling!=this.selection_.endRow;)this.rowNodes_.removeChild(this.selection_.startRow.nextSibling);for(;this.rowNodes_.lastChild!=this.selection_.endRow;)this.rowNodes_.removeChild(this.rowNodes_.lastChild)}};
hterm.ScrollPort.prototype.drawVisibleRows_=function(a){function b(a,b){for(;a!=b;){if(!a)throw"Did not encounter target node";if(a==c.bottomFold_)throw"Encountered bottom fold before target node";var d=a,a=a.nextSibling;d.parentNode.removeChild(d)}}for(var c=this,e=this.selection_.startRow,f=this.selection_.endRow,h=this.bottomFold_,g=this.topFold_.nextSibling,m=Math.min(this.visibleRowCount,this.rowProvider_.getRowCount()),n=0;n<m;n++){var k=a+n;if(g==h){var d=this.fetchRowNode_(k);if(!d){console.log("Couldn't fetch row index: "+
k);break}this.rowNodes_.insertBefore(d,g)}else if(g.rowIndex==k)g=g.nextSibling;else if(e&&e.rowIndex==k)b(g,e),g=e.nextSibling;else if(f&&f.rowIndex==k)b(g,f),g=f.nextSibling;else if(g==e||g==f){d=this.fetchRowNode_(k);if(!d){console.log("Couldn't fetch row index: "+k);break}this.rowNodes_.insertBefore(d,g)}else{d=this.fetchRowNode_(k);if(!d){console.log("Couldn't fetch row index: "+k);break}if(g==d)g=g.nextSibling;else{this.rowNodes_.insertBefore(d,g);if(!d.nextSibling)debugger;this.rowNodes_.removeChild(g);
g=d.nextSibling}}}g!=this.bottomFold_&&b(g,h)};hterm.ScrollPort.prototype.resetSelectBags_=function(){this.topSelectBag_.parentNode&&(this.topSelectBag_.textContent="",this.topSelectBag_.parentNode.removeChild(this.topSelectBag_));this.bottomSelectBag_.parentNode&&(this.bottomSelectBag_.textContent="",this.bottomSelectBag_.parentNode.removeChild(this.bottomSelectBag_))};
hterm.ScrollPort.prototype.syncRowNodesTop_=function(){for(var a=0,b=this.topFold_.previousSibling;b;)a+=this.characterSize.height,b=b.previousSibling;this.rowNodes_.style.top=this.screen_.offsetTop-a+"px"};hterm.ScrollPort.prototype.cacheRowNode_=function(a){this.currentRowNodeCache_[a.rowIndex]=a};
hterm.ScrollPort.prototype.fetchRowNode_=function(a){a=this.previousRowNodeCache_&&a in this.previousRowNodeCache_?this.previousRowNodeCache_[a]:this.rowProvider_.getRowNode(a);this.currentRowNodeCache_&&this.cacheRowNode_(a);return a};
hterm.ScrollPort.prototype.selectAll=function(){var a;if(0!=this.topFold_.nextSibling.rowIndex){for(;this.topFold_.previousSibling;)this.rowNodes_.removeChild(this.topFold_.previousSibling);a=this.fetchRowNode_(0);this.rowNodes_.insertBefore(a,this.topFold_);this.syncRowNodesTop_()}else a=this.topFold_.nextSibling;var b=this.rowProvider_.getRowCount()-1;if(this.bottomFold_.previousSibling.rowIndex!=b){for(;this.bottomFold_.nextSibling;)this.rowNodes_.removeChild(this.bottomFold_.nextSibling);b=this.fetchRowNode_(b);
this.rowNodes_.appendChild(b)}else b=this.bottomFold_.previousSibling.rowIndex;var c=this.document_.getSelection();c.collapse(a,0);c.extend(b,b.childNodes.length);this.selection_.sync()};hterm.ScrollPort.prototype.getScrollMax_=function(){return this.scrollArea_.clientHeight+this.visibleRowTopMargin+this.visibleRowBottomMargin-this.screen_.clientHeight};
hterm.ScrollPort.prototype.scrollRowToTop=function(a){this.syncScrollHeight();var a=a*this.characterSize.height+this.visibleRowTopMargin,b=this.getScrollMax_();a>b&&(a=b);this.screen_.scrollTop!=a&&(this.screen_.scrollTop=a,this.scheduleRedraw())};
hterm.ScrollPort.prototype.scrollRowToBottom=function(a){this.syncScrollHeight();a=a*this.characterSize.height+this.visibleRowTopMargin+this.visibleRowBottomMargin;a-=this.visibleRowCount*this.characterSize.height;0>a&&(a=0);this.screen_.scrollTop!=a&&(this.screen_.scrollTop=a)};hterm.ScrollPort.prototype.getTopRowIndex=function(){return Math.floor(this.screen_.scrollTop/this.characterSize.height)};hterm.ScrollPort.prototype.getBottomRowIndex=function(a){return a+this.visibleRowCount-1};
hterm.ScrollPort.prototype.onScroll_=function(){this.screen_.clientWidth!=this.lastScreenWidth_||this.screen_.clientHeight!=this.lastScreenHeight_?this.resize():(this.redraw_(),this.publish("scroll",{scrollPort:this}))};hterm.ScrollPort.prototype.onScrollWheel_=function(a){a=this.screen_.scrollTop-a.wheelDeltaY;0>a&&(a=0);var b=this.getScrollMax_();a>b&&(a=b);this.screen_.scrollTop=a};hterm.ScrollPort.prototype.onResize_=function(){this.resize()};
hterm.ScrollPort.prototype.onCopy_=function(){this.resetSelectBags_();this.selection_.sync();if(this.selection_.startRow&&!(2>this.selection_.endRow.rowIndex-this.selection_.startRow.rowIndex)){var a=this.getTopRowIndex(),b=this.getBottomRowIndex(a);this.selection_.startRow.rowIndex<a&&(this.topSelectBag_.textContent=this.rowProvider_.getRowsText(this.selection_.startRow.rowIndex+1,this.selection_.endRow.rowIndex<a?this.selection_.endRow.rowIndex:this.topFold_.nextSibling.rowIndex),this.rowNodes_.insertBefore(this.topSelectBag_,
this.selection_.startRow.nextSibling),this.syncRowNodesTop_());this.selection_.endRow.rowIndex>b&&(this.bottomSelectBag_.textContent=this.rowProvider_.getRowsText(this.selection_.startRow.rowIndex>b?this.selection_.startRow.rowIndex+1:this.bottomFold_.previousSibling.rowIndex+1,this.selection_.endRow.rowIndex),this.rowNodes_.insertBefore(this.bottomSelectBag_,this.selection_.endRow))}};
hterm.ScrollPort.prototype.onPaste_=function(){this.pasteTarget_.focus();var a=this;setTimeout(function(){a.publish("paste",{text:a.pasteTarget_.value});a.pasteTarget_.value="";a.screen_.focus()},0)};hterm.ScrollPort.prototype.setScrollbarVisible=function(a){this.screen_.style.overflowY=a?"scroll":"hidden"};lib.rtdep("lib.colors","lib.PreferenceManager","hterm.msg","hterm.Keyboard","hterm.Options","hterm.Screen","hterm.ScrollPort","hterm.Size","hterm.VT");
hterm.Terminal=function(a){this.profileName_=null;this.setProfile(a||"default");this.primaryScreen_=new hterm.Screen;this.alternateScreen_=new hterm.Screen;this.screen_=this.primaryScreen_;this.screenSize=new hterm.Size(0,0);this.scrollPort_=new hterm.ScrollPort(this);this.scrollPort_.subscribe("resize",this.onResize_.bind(this));this.scrollPort_.subscribe("scroll",this.onScroll_.bind(this));this.scrollPort_.subscribe("paste",this.onPaste_.bind(this));this.div_=null;this.document_=window.document;
this.scrollbackRows_=[];this.tabStops_=[];this.defaultTabStops=!0;this.cursorNode_=this.vtScrollBottom_=this.vtScrollTop_=null;this.scrollOnOutput_=this.prefs_.get("scroll-on-output");this.scrollOnKeystroke_=this.prefs_.get("scroll-on-keystroke");this.foregroundColor_=this.prefs_.get("foreground-color");this.backgroundColor_=this.prefs_.get("background-color");this.bellAudio_=this.document_.createElement("audio");this.bellAudio_.setAttribute("src",this.prefs_.get("audible-bell-sound"));this.bellAudio_.setAttribute("preload",
"auto");this.savedOptions_={};this.options_=new hterm.Options;this.timeouts_={};this.vt=new hterm.VT(this);this.vt.enable8BitControl=this.prefs_.get("enable-8-bit-control");this.vt.maxStringSequence=this.prefs_.get("max-string-sequence");this.keyboard=new hterm.Keyboard(this);this.io=new hterm.Terminal.IO(this);this.realizeSize_(80,24);this.setDefaultTabStops()};hterm.Terminal.prototype.tabWidth=8;hterm.Terminal.prototype.scrollbarWidthPx=16;
hterm.Terminal.prototype.setProfile=function(a){var b=!!this.profileName_;this.profileName_=a.replace(/\//g,"");this.prefs_=new lib.PreferenceManager("/hterm/prefs/profiles/"+this.profileName_);var c=this;this.prefs_.definePreferences([["alt-is-meta",!1,function(a){c.keyboard.altIsMeta=a}],["alt-sends-what","escape",function(a){/^(escape|8-bit|browser-key)$/.test(a)||(a="escape");c.keyboard.altSendsWhat=a}],["audible-bell-sound","../audio/bell.ogg",function(a){c.bellAudio_.setAttribute("src",a)}],
["background-color","rgb(16, 16, 16)",function(a){c.setBackgroundColor(a)}],["background-image","",function(a){c.scrollPort_.setBackgroundImage(a)}],["background-size","",function(a){c.scrollPort_.setBackgroundSize(a)}],["background-position","",function(a){c.scrollPort_.setBackgroundPosition(a)}],["backspace-sends-backspace",!1,function(a){c.keyboard.backspaceSendsBackspace=a}],["cursor-blink",!1,function(a){c.setCursorBlink(!!a)}],["cursor-color","rgba(255,0,0,0.5)",function(a){c.setCursorColor(a)}],
["enable-8-bit-control",!1,function(a){c.vt.enable8BitControl=!!a}],["enable-bold",null,function(){c.syncBoldSafeState()}],["font-family",'"DejaVu Sans Mono", "Everson Mono", FreeMono, "Menlo", "Lucida Console", monospace',function(){c.syncFontFamily()}],["font-size",15,function(a){c.setFontSize(a)}],["font-smoothing","antialiased",function(){c.syncFontFamily()}],["foreground-color","rgb(240, 240, 240)",function(a){c.setForegroundColor(a)}],["home-keys-scroll",!1,function(a){c.keyboard.homeKeysScroll=
a}],["max-string-sequence",1024,function(a){c.vt.maxStringSequence=a}],["meta-sends-escape",!0,function(a){c.keyboard.metaSendsEscape=a}],["scroll-on-keystroke",!0,function(a){c.scrollOnKeystroke_=a}],["scroll-on-output",!1,function(a){c.scrollOnOutput_=a}],["scrollbar-visible",!0,function(a){c.setScrollbarVisible(a)}],["environment",{TERM:"xterm-256color"},null],["page-keys-scroll",!1,function(a){c.keyboard.pageKeysScroll=a}]]);b&&this.prefs_.notifyAll()};
hterm.Terminal.prototype.setCursorColor=function(a){this.cursorNode_.style.backgroundColor=a;this.cursorNode_.style.borderColor=a};hterm.Terminal.prototype.getCursorColor=function(){return this.cursorNode_.style.backgroundColor};hterm.Terminal.prototype.setBackgroundColor=function(a){this.backgroundColor_=lib.colors.normalizeCSS(a);this.scrollPort_.setBackgroundColor(a)};hterm.Terminal.prototype.getBackgroundColor=function(){return this.backgroundColor_};
hterm.Terminal.prototype.setForegroundColor=function(a){this.foregroundColor_=lib.colors.normalizeCSS(a);this.scrollPort_.setForegroundColor(a)};hterm.Terminal.prototype.getForegroundColor=function(){return this.foregroundColor_};
hterm.Terminal.prototype.runCommandClass=function(a,b){var c=this.prefs_.get("environment");if("object"!=typeof c||null==c)c={};var e=this;this.command=new a({argString:b||"",io:this.io.push(),environment:c,onExit:function(a){e.io.pop();e.io.println(hterm.msg("COMMAND_COMPLETE",[e.command.commandName,a]));e.uninstallKeyboard()}});this.installKeyboard();this.command.run()};hterm.Terminal.prototype.isPrimaryScreen=function(){return this.screen_==this.primaryScreen_};
hterm.Terminal.prototype.installKeyboard=function(){this.keyboard.installKeyboard(this.document_.body.firstChild)};hterm.Terminal.prototype.uninstallKeyboard=function(){this.keyboard.installKeyboard(null)};hterm.Terminal.prototype.setFontSize=function(a){0===a&&(a=this.prefs_.get("font-size"));this.scrollPort_.setFontSize(a)};hterm.Terminal.prototype.getFontSize=function(){return this.scrollPort_.getFontSize()};hterm.Terminal.prototype.getFontFamily=function(){return this.scrollPort_.getFontFamily()};
hterm.Terminal.prototype.syncFontFamily=function(){this.scrollPort_.setFontFamily(this.prefs_.get("font-family"),this.prefs_.get("font-smoothing"));this.syncBoldSafeState()};
hterm.Terminal.prototype.syncBoldSafeState=function(){var a=this.prefs_.get("enable-bold");if(null===a){var a=this.scrollPort_.measureCharacterSize(),b=this.scrollPort_.measureCharacterSize("bold");(a=a.equals(b))||console.warn("Bold characters disabled: Size of bold weight differs from normal.  Font family is: "+this.scrollPort_.getFontFamily())}this.screen_.textAttributes.enableBold=a};hterm.Terminal.prototype.saveCursor=function(){return this.screen_.cursorPosition.clone()};
hterm.Terminal.prototype.getTextAttributes=function(){return this.screen_.textAttributes};hterm.Terminal.prototype.setTextAttributes=function(a){this.screen_.textAttributes=a};hterm.Terminal.prototype.getZoomFactor=function(){return this.scrollPort_.characterSize.zoomFactor};hterm.Terminal.prototype.setWindowTitle=function(a){window.document.title=a};
hterm.Terminal.prototype.restoreCursor=function(a){var b=lib.f.clamp(a.row,0,this.screenSize.height-1),c=lib.f.clamp(a.column,0,this.screenSize.width-1);this.screen_.setCursorPosition(b,c);if(a.column>c||a.column==c&&a.overflow)this.screen_.cursorPosition.overflow=!0};hterm.Terminal.prototype.clearCursorOverflow=function(){this.screen_.cursorPosition.overflow=!1};
hterm.Terminal.prototype.setWidth=function(a){null==a?this.div_.style.width="100%":(this.div_.style.width=this.scrollPort_.characterSize.width*a+this.scrollbarWidthPx+"px",this.realizeSize_(a,this.screenSize.height),this.scheduleSyncCursorPosition_())};hterm.Terminal.prototype.setHeight=function(a){null==a?this.div_.style.height="100%":(this.div_.style.height=this.scrollPort_.characterSize.height*a+"px",this.realizeSize_(this.screenSize.width,a),this.scheduleSyncCursorPosition_())};
hterm.Terminal.prototype.realizeSize_=function(a,b){a!=this.screenSize.width&&this.realizeWidth_(a);b!=this.screenSize.height&&this.realizeHeight_(b);this.io.onTerminalResize(a,b)};hterm.Terminal.prototype.realizeWidth_=function(a){var b=a-this.screen_.getWidth();this.screenSize.width=a;this.screen_.setColumnCount(a);if(0<b)this.defaultTabStops&&this.setDefaultTabStops(this.screenSize.width-b);else for(b=this.tabStops_.length-1;0<=b&&!(this.tabStops_[b]<a);b--)this.tabStops_.pop();this.screen_.setColumnCount(this.screenSize.width)};
hterm.Terminal.prototype.realizeHeight_=function(a){var b=a-this.screen_.getHeight();this.screenSize.height=a;a=this.saveCursor();if(0>b){for(b*=-1;b;){var c=this.getRowCount()-1;if(c-this.scrollbackRows_.length==a.row)break;if(this.getRowText(c))break;this.screen_.popRow();b--}c=this.screen_.shiftRows(b);this.scrollbackRows_.push.apply(this.scrollbackRows_,c);a.row=Math.max(a.row-b,0)}else if(0<b){if(b<=this.scrollbackRows_.length){var c=Math.min(b,this.scrollbackRows_.length),e=this.scrollbackRows_.splice(this.scrollbackRows_.length-
c,c);this.screen_.unshiftRows(e);b-=c;a.row+=c}b&&this.appendRows_(b)}this.setVTScrollRegion(null,null);this.restoreCursor(a)};hterm.Terminal.prototype.scrollHome=function(){this.scrollPort_.scrollRowToTop(0)};hterm.Terminal.prototype.scrollEnd=function(){this.scrollPort_.scrollRowToBottom(this.getRowCount())};hterm.Terminal.prototype.scrollPageUp=function(){var a=this.scrollPort_.getTopRowIndex();this.scrollPort_.scrollRowToTop(a-this.screenSize.height+1)};
hterm.Terminal.prototype.scrollPageDown=function(){var a=this.scrollPort_.getTopRowIndex();this.scrollPort_.scrollRowToTop(a+this.screenSize.height-1)};hterm.Terminal.prototype.reset=function(){this.clearAllTabStops();this.setDefaultTabStops();this.clearHome(this.primaryScreen_);this.primaryScreen_.textAttributes.reset();this.clearHome(this.alternateScreen_);this.alternateScreen_.textAttributes.reset();this.setCursorBlink(!!this.prefs_.get("cursor-blink"));this.softReset()};
hterm.Terminal.prototype.softReset=function(){this.options_=new hterm.Options;this.primaryScreen_.textAttributes.resetColorPalette();this.alternateScreen_.textAttributes.resetColorPalette();this.setVTScrollRegion(null,null);this.setCursorVisible(!0)};
hterm.Terminal.prototype.forwardTabStop=function(){for(var a=this.screen_.cursorPosition.column,b=0;b<this.tabStops_.length;b++)if(this.tabStops_[b]>a){this.setCursorColumn(this.tabStops_[b]);return}a=this.screen_.cursorPosition.overflow;this.setCursorColumn(this.screenSize.width-1);this.screen_.cursorPosition.overflow=a};
hterm.Terminal.prototype.backwardTabStop=function(){for(var a=this.screen_.cursorPosition.column,b=this.tabStops_.length-1;0<=b;b--)if(this.tabStops_[b]<a){this.setCursorColumn(this.tabStops_[b]);return}this.setCursorColumn(1)};hterm.Terminal.prototype.setTabStop=function(a){for(var b=this.tabStops_.length-1;0<=b;b--){if(this.tabStops_[b]==a)return;if(this.tabStops_[b]<a){this.tabStops_.splice(b+1,0,a);return}}this.tabStops_.splice(0,0,a)};
hterm.Terminal.prototype.clearTabStopAtCursor=function(){var a=this.tabStops_.indexOf(this.screen_.cursorPosition.column);-1!=a&&this.tabStops_.splice(a,1)};hterm.Terminal.prototype.clearAllTabStops=function(){this.tabStops_.length=0;this.defaultTabStops=!1};hterm.Terminal.prototype.setDefaultTabStops=function(a){for(var b=a||0,a=this.tabWidth,b=b-1-(b-1)%a+a;b<this.screenSize.width;b+=a)this.setTabStop(b);this.defaultTabStops=!0};
hterm.Terminal.prototype.interpret=function(a){this.vt.interpret(a);this.scheduleSyncCursorPosition_()};
hterm.Terminal.prototype.decorate=function(a){this.div_=a;this.scrollPort_.decorate(a);this.scrollPort_.setBackgroundImage(this.prefs_.get("background-image"));this.scrollPort_.setBackgroundSize(this.prefs_.get("background-size"));this.scrollPort_.setBackgroundPosition(this.prefs_.get("background-position"));this.div_.focus=this.focus.bind(this);this.setFontSize(this.prefs_.get("font-size"));this.syncFontFamily();this.setScrollbarVisible(this.prefs_.get("scrollbar-visible"));this.document_=this.scrollPort_.getDocument();
this.document_.body.firstChild.addEventListener("focus",this.onFocusChange_.bind(this,!0));this.document_.body.firstChild.addEventListener("blur",this.onFocusChange_.bind(this,!1));a=this.document_.createElement("style");a.textContent='.cursor-node[focus="false"] {  box-sizing: border-box;  background-color: transparent !important;  border-width: 2px;  border-style: solid;}';this.document_.head.appendChild(a);this.cursorNode_=this.document_.createElement("div");this.cursorNode_.className="cursor-node";
this.cursorNode_.style.cssText="position: absolute;top: -99px;display: block;width: "+this.scrollPort_.characterSize.width+"px;height: "+this.scrollPort_.characterSize.height+"px;-webkit-transition: opacity, background-color 100ms linear;";this.setCursorColor(this.prefs_.get("cursor-color"));this.document_.body.appendChild(this.cursorNode_);this.setCursorBlink(!!this.prefs_.get("cursor-blink"));this.setReverseVideo(!1);this.scrollPort_.focus();this.scrollPort_.scheduleRedraw()};
hterm.Terminal.prototype.getDocument=function(){return this.document_};hterm.Terminal.prototype.focus=function(){this.scrollPort_.focus()};hterm.Terminal.prototype.getRowNode=function(a){return a<this.scrollbackRows_.length?this.scrollbackRows_[a]:this.screen_.rowsArray[a-this.scrollbackRows_.length]};hterm.Terminal.prototype.getRowsText=function(a,b){for(var c=[],e=a;e<b;e++){var f=this.getRowNode(e);c.push(f.textContent)}return c.join("\n")};hterm.Terminal.prototype.getRowText=function(a){return this.getRowNode(a).textContent};
hterm.Terminal.prototype.getRowCount=function(){return this.scrollbackRows_.length+this.screen_.rowsArray.length};
hterm.Terminal.prototype.appendRows_=function(a){for(var b=this.screen_.rowsArray.length,c=this.scrollbackRows_.length+b,e=0;e<a;e++){var f=this.document_.createElement("x-row");f.appendChild(this.document_.createTextNode(""));f.rowIndex=c+e;this.screen_.pushRow(f)}a=this.screen_.rowsArray.length-this.screenSize.height;0<a&&(a=this.screen_.shiftRows(a),Array.prototype.push.apply(this.scrollbackRows_,a),this.scheduleScrollDown_());b>=this.screen_.rowsArray.length&&(b=this.screen_.rowsArray.length-
1);this.setAbsoluteCursorPosition(b,0)};hterm.Terminal.prototype.moveRows_=function(a,b,c){var e=this.screen_.removeRows(a,b);this.screen_.insertRows(c,e);a<c?(e=a,a=c+b):(e=c,a+=b);this.renumberRows_(e,a);this.scrollPort_.scheduleInvalidate()};hterm.Terminal.prototype.renumberRows_=function(a,b){for(var c=this.scrollbackRows_.length,e=a;e<b;e++)this.screen_.rowsArray[e].rowIndex=c+e};
hterm.Terminal.prototype.print=function(a){this.options_.wraparound&&this.screen_.cursorPosition.overflow&&this.newLine();this.options_.insertMode?this.screen_.insertString(a):this.screen_.overwriteString(a);a=this.screen_.maybeClipCurrentRow();if(this.options_.wraparound&&a){var b;do this.newLine(),b=a.characterLength,this.options_.insertMode||this.screen_.deleteChars(a.characterLength),this.screen_.prependNodes(a),a=this.screen_.maybeClipCurrentRow();while(a);this.setCursorColumn(b)}this.scheduleSyncCursorPosition_();
this.scrollOnOutput_&&this.scrollPort_.scrollRowToBottom(this.getRowCount())};hterm.Terminal.prototype.setVTScrollRegion=function(a,b){this.vtScrollTop_=a;this.vtScrollBottom_=b};hterm.Terminal.prototype.getVTScrollTop=function(){return null!=this.vtScrollTop_?this.vtScrollTop_:0};hterm.Terminal.prototype.getVTScrollBottom=function(){return null!=this.vtScrollBottom_?this.vtScrollBottom_:this.screenSize.height-1};
hterm.Terminal.prototype.newLine=function(){this.screen_.cursorPosition.row==this.screen_.rowsArray.length-1?this.appendRows_(1):this.screen_.cursorPosition.row==this.getVTScrollBottom()?(this.vtScrollUp(1),this.setAbsoluteCursorPosition(this.screen_.cursorPosition.row,0)):this.setAbsoluteCursorPosition(this.screen_.cursorPosition.row+1,0)};hterm.Terminal.prototype.lineFeed=function(){var a=this.screen_.cursorPosition.column;this.newLine();this.setCursorColumn(a)};
hterm.Terminal.prototype.formFeed=function(){this.options_.autoCarriageReturn?this.newLine():this.lineFeed()};hterm.Terminal.prototype.reverseLineFeed=function(){var a=this.getVTScrollTop(),b=this.screen_.cursorPosition.row;b==a?this.insertLines(1):this.setAbsoluteCursorRow(b-1)};hterm.Terminal.prototype.eraseToLeft=function(){var a=this.saveCursor();this.setCursorColumn(0);this.screen_.overwriteString(lib.f.getWhitespace(a.column+1));this.restoreCursor(a)};
hterm.Terminal.prototype.eraseToRight=function(a){var b=this.saveCursor(),c=this.screenSize.width-b.column;void 0===a||a>=c?this.screen_.deleteChars(c):this.screen_.overwriteString(lib.f.getWhitespace(a));this.restoreCursor(b);this.clearCursorOverflow()};hterm.Terminal.prototype.eraseLine=function(){var a=this.saveCursor();this.screen_.clearCursorRow();this.restoreCursor(a);this.clearCursorOverflow()};
hterm.Terminal.prototype.eraseAbove=function(){var a=this.saveCursor();this.eraseToLeft();for(var b=0;b<a.row;b++)this.setAbsoluteCursorPosition(b,0),this.screen_.clearCursorRow();this.restoreCursor(a);this.clearCursorOverflow()};hterm.Terminal.prototype.eraseBelow=function(){var a=this.saveCursor();this.eraseToRight();for(var b=this.screenSize.height-1,c=a.row+1;c<=b;c++)this.setAbsoluteCursorPosition(c,0),this.screen_.clearCursorRow();this.restoreCursor(a);this.clearCursorOverflow()};
hterm.Terminal.prototype.fill=function(a){var b=this.saveCursor();this.setAbsoluteCursorPosition(0,0);for(var c=0;c<this.screenSize.height;c++)for(var e=0;e<this.screenSize.width;e++)this.setAbsoluteCursorPosition(c,e),this.screen_.overwriteString(a);this.restoreCursor(b)};hterm.Terminal.prototype.clearHome=function(a){var a=a||this.screen_,b=a.getHeight();if(0!=b){for(var c=0;c<b;c++)a.setCursorPosition(c,0),a.clearCursorRow();a.setCursorPosition(0,0)}};
hterm.Terminal.prototype.clear=function(a){var a=a||this.screen_,b=a.cursorPosition.clone();this.clearHome(a);a.setCursorPosition(b.row,b.column)};hterm.Terminal.prototype.insertLines=function(a){var b=this.saveCursor(),c=this.getVTScrollBottom(),a=Math.min(a,c-b.row),c=c-a+1;c!=b.row&&this.moveRows_(c,a,b.row);for(c=0;c<a;c++)this.setAbsoluteCursorPosition(b.row+c,0),this.screen_.clearCursorRow();b.column=0;this.restoreCursor(b)};
hterm.Terminal.prototype.deleteLines=function(a){var b=this.saveCursor(),c=b.row,e=this.getVTScrollBottom(),f=e-c+1,a=Math.min(a,f),e=e-a+1;a!=f&&this.moveRows_(c,a,e);for(c=0;c<a;c++)this.setAbsoluteCursorPosition(e+c,0),this.screen_.clearCursorRow();this.restoreCursor(b);this.clearCursorOverflow()};hterm.Terminal.prototype.insertSpace=function(a){var b=this.saveCursor(),a=lib.f.getWhitespace(a||1);this.screen_.insertString(a);this.screen_.maybeClipCurrentRow();this.restoreCursor(b);this.clearCursorOverflow()};
hterm.Terminal.prototype.deleteChars=function(a){this.screen_.deleteChars(a);this.clearCursorOverflow()};hterm.Terminal.prototype.vtScrollUp=function(a){var b=this.saveCursor();this.setAbsoluteCursorRow(this.getVTScrollTop());this.deleteLines(a);this.restoreCursor(b)};hterm.Terminal.prototype.vtScrollDown=function(a){var b=this.saveCursor();this.setAbsoluteCursorPosition(this.getVTScrollTop(),0);this.insertLines(a);this.restoreCursor(b)};
hterm.Terminal.prototype.setCursorPosition=function(a,b){this.options_.originMode?this.setRelativeCursorPosition(a,b):this.setAbsoluteCursorPosition(a,b)};hterm.Terminal.prototype.setRelativeCursorPosition=function(a,b){var c=this.getVTScrollTop(),a=lib.f.clamp(a+c,c,this.getVTScrollBottom()),b=lib.f.clamp(b,0,this.screenSize.width-1);this.screen_.setCursorPosition(a,b)};
hterm.Terminal.prototype.setAbsoluteCursorPosition=function(a,b){a=lib.f.clamp(a,0,this.screenSize.height-1);b=lib.f.clamp(b,0,this.screenSize.width-1);this.screen_.setCursorPosition(a,b)};hterm.Terminal.prototype.setCursorColumn=function(a){this.setAbsoluteCursorPosition(this.screen_.cursorPosition.row,a)};hterm.Terminal.prototype.getCursorColumn=function(){return this.screen_.cursorPosition.column};hterm.Terminal.prototype.setAbsoluteCursorRow=function(a){this.setAbsoluteCursorPosition(a,this.screen_.cursorPosition.column)};
hterm.Terminal.prototype.getCursorRow=function(){return this.screen_.cursorPosition.row};hterm.Terminal.prototype.scheduleRedraw_=function(){if(!this.timeouts_.redraw){var a=this;this.timeouts_.redraw=setTimeout(function(){delete a.timeouts_.redraw;a.scrollPort_.redraw_()},0)}};
hterm.Terminal.prototype.scheduleScrollDown_=function(){if(!this.timeouts_.scrollDown){var a=this;this.timeouts_.scrollDown=setTimeout(function(){delete a.timeouts_.scrollDown;a.scrollPort_.scrollRowToBottom(a.getRowCount())},10)}};hterm.Terminal.prototype.cursorUp=function(a){return this.cursorDown(-(a||1))};
hterm.Terminal.prototype.cursorDown=function(a){var a=a||1,b=this.options_.originMode?this.getVTScrollTop():0,c=this.options_.originMode?this.getVTScrollBottom():this.screenSize.height-1,a=lib.f.clamp(this.screen_.cursorPosition.row+a,b,c);this.setAbsoluteCursorRow(a)};hterm.Terminal.prototype.cursorLeft=function(a){return this.cursorRight(-(a||1))};hterm.Terminal.prototype.cursorRight=function(a){a=lib.f.clamp(this.screen_.cursorPosition.column+(a||1),0,this.screenSize.width-1);this.setCursorColumn(a)};
hterm.Terminal.prototype.setReverseVideo=function(a){(this.options_.reverseVideo=a)?(this.scrollPort_.setForegroundColor(this.prefs_.get("background-color")),this.scrollPort_.setBackgroundColor(this.prefs_.get("foreground-color"))):(this.scrollPort_.setForegroundColor(this.prefs_.get("foreground-color")),this.scrollPort_.setBackgroundColor(this.prefs_.get("background-color")))};
hterm.Terminal.prototype.ringBell=function(){this.bellAudio_.getAttribute("src")&&this.bellAudio_.play();this.cursorNode_.style.backgroundColor=this.scrollPort_.getForegroundColor();var a=this;setTimeout(function(){a.cursorNode_.style.backgroundColor=a.prefs_.get("cursor-color")},200)};hterm.Terminal.prototype.setOriginMode=function(a){this.options_.originMode=a;this.setCursorPosition(0,0)};hterm.Terminal.prototype.setInsertMode=function(a){this.options_.insertMode=a};
hterm.Terminal.prototype.setAutoCarriageReturn=function(a){this.options_.autoCarriageReturn=a};hterm.Terminal.prototype.setWraparound=function(a){this.options_.wraparound=a};hterm.Terminal.prototype.setReverseWraparound=function(a){this.options_.reverseWraparound=a};
hterm.Terminal.prototype.setAlternateMode=function(a){var b=this.saveCursor();this.screen_=a?this.alternateScreen_:this.primaryScreen_;if(this.screen_.rowsArray.length&&this.screen_.rowsArray[0].rowIndex!=this.scrollbackRows_.length)for(var a=this.scrollbackRows_.length,c=this.screen_.rowsArray,e=0;e<c.length;e++)c[e].rowIndex=a+e;this.realizeWidth_(this.screenSize.width);this.realizeHeight_(this.screenSize.height);this.scrollPort_.syncScrollHeight();this.scrollPort_.invalidate();this.restoreCursor(b);
this.scrollPort_.resize()};hterm.Terminal.prototype.setCursorBlink=function(a){this.options_.cursorBlink=a;!a&&this.timeouts_.cursorBlink&&(clearTimeout(this.timeouts_.cursorBlink),delete this.timeouts_.cursorBlink);this.options_.cursorVisible&&this.setCursorVisible(!0)};
hterm.Terminal.prototype.setCursorVisible=function(a){(this.options_.cursorVisible=a)?(this.syncCursorPosition_(),this.cursorNode_.style.opacity="1",this.options_.cursorBlink?this.timeouts_.cursorBlink||(this.timeouts_.cursorBlink=setInterval(this.onCursorBlink_.bind(this),500)):this.timeouts_.cursorBlink&&(clearTimeout(this.timeouts_.cursorBlink),delete this.timeouts_.cursorBlink)):this.cursorNode_.style.opacity="0"};
hterm.Terminal.prototype.syncCursorPosition_=function(){var a=this.scrollPort_.getTopRowIndex(),b=this.scrollPort_.getBottomRowIndex(a),c=this.scrollbackRows_.length+this.screen_.cursorPosition.row;c>b?this.cursorNode_.style.top=-this.scrollPort_.characterSize.height+"px":(this.cursorNode_.style.width=this.scrollPort_.characterSize.width+"px",this.cursorNode_.style.height=this.scrollPort_.characterSize.height+"px",this.cursorNode_.style.top=this.scrollPort_.visibleRowTopMargin+this.scrollPort_.characterSize.height*
(c-a)+"px",this.cursorNode_.style.left=this.scrollPort_.characterSize.width*this.screen_.cursorPosition.column+"px",this.cursorNode_.setAttribute("title","("+this.screen_.cursorPosition.row+", "+this.screen_.cursorPosition.column+")"),(a=this.document_.getSelection())&&a.isCollapsed&&this.screen_.syncSelectionCaret(a))};
hterm.Terminal.prototype.scheduleSyncCursorPosition_=function(){if(!this.timeouts_.syncCursor){var a=this;this.timeouts_.syncCursor=setTimeout(function(){a.syncCursorPosition_();delete a.timeouts_.syncCursor},0)}};
hterm.Terminal.prototype.showZoomWarning_=function(a){if(!this.zoomWarningNode_){if(!a)return;this.zoomWarningNode_=this.document_.createElement("div");this.zoomWarningNode_.style.cssText="color: black;background-color: #ff2222;font-size: large;border-radius: 8px;opacity: 0.75;padding: 0.2em 0.5em 0.2em 0.5em;top: 0.5em;right: 1.2em;position: absolute;-webkit-text-size-adjust: none;-webkit-user-select: none;"}this.zoomWarningNode_.textContent=hterm.msg("ZOOM_WARNING")||"!! "+parseInt(100*this.scrollPort_.characterSize.zoomFactor)+
"% !!";this.zoomWarningNode_.style.fontFamily=this.prefs_.get("font-family");a?this.zoomWarningNode_.parentNode||this.div_.parentNode.appendChild(this.zoomWarningNode_):this.zoomWarningNode_.parentNode&&this.zoomWarningNode_.parentNode.removeChild(this.zoomWarningNode_)};
hterm.Terminal.prototype.showOverlay=function(a,b){if(!this.overlayNode_){if(!this.div_)return;this.overlayNode_=this.document_.createElement("div");this.overlayNode_.style.cssText="border-radius: 15px;font-size: xx-large;opacity: 0.75;padding: 0.2em 0.5em 0.2em 0.5em;position: absolute;-webkit-user-select: none;-webkit-transition: opacity 180ms ease-in;"}this.overlayNode_.style.color=this.prefs_.get("background-color");this.overlayNode_.style.backgroundColor=this.prefs_.get("foreground-color");this.overlayNode_.style.fontFamily=
this.prefs_.get("font-family");this.overlayNode_.textContent=a;this.overlayNode_.style.opacity="0.75";this.overlayNode_.parentNode||this.div_.appendChild(this.overlayNode_);this.overlayNode_.style.top=(this.div_.clientHeight-this.overlayNode_.clientHeight)/2;this.overlayNode_.style.left=(this.div_.clientWidth-this.overlayNode_.clientWidth-this.scrollbarWidthPx)/2;var c=this;this.overlayTimeout_&&clearTimeout(this.overlayTimeout_);null!==b&&(this.overlayTimeout_=setTimeout(function(){c.overlayNode_.style.opacity=
"0";setTimeout(function(){c.overlayNode_.parentNode&&c.overlayNode_.parentNode.removeChild(c.overlayNode_);c.overlayTimeout_=null;c.overlayNode_.style.opacity="0.75"},200)},b||1500))};hterm.Terminal.prototype.overlaySize=function(){this.showOverlay(this.screenSize.width+"x"+this.screenSize.height)};hterm.Terminal.prototype.onVTKeystroke=function(a){this.scrollOnKeystroke_&&this.scrollPort_.scrollRowToBottom(this.getRowCount());this.io.onVTKeystroke(a)};
hterm.Terminal.prototype.onFocusChange_=function(a){this.cursorNode_.setAttribute("focus",a?"true":"false")};hterm.Terminal.prototype.onScroll_=function(){this.scheduleSyncCursorPosition_()};hterm.Terminal.prototype.onPaste_=function(a){this.io.onVTKeystroke(this.vt.encodeUTF8(a.text))};
hterm.Terminal.prototype.onResize_=function(){var a=Math.floor(this.scrollPort_.getScreenWidth()/this.scrollPort_.characterSize.width),b=Math.floor(this.scrollPort_.getScreenHeight()/this.scrollPort_.characterSize.height);if(a||b)this.realizeSize_(a,b),this.scheduleSyncCursorPosition_(),this.showZoomWarning_(1!=this.scrollPort_.characterSize.zoomFactor),this.overlaySize()};hterm.Terminal.prototype.onCursorBlink_=function(){this.cursorNode_.style.opacity="0"==this.cursorNode_.style.opacity?"1":"0"};
hterm.Terminal.prototype.setScrollbarVisible=function(a){this.scrollPort_.setScrollbarVisible(a)};hterm.Terminal.IO=function(a){this.terminal_=a;this.previousIO_=null};hterm.Terminal.IO.prototype.showOverlay=function(a,b){this.terminal_.showOverlay(a,b)};hterm.Terminal.IO.prototype.createFrame=function(a,b){return new hterm.Frame(this.terminal_,a,b)};hterm.Terminal.IO.prototype.setTerminalProfile=function(a){this.terminal_.setProfile(a)};
hterm.Terminal.IO.prototype.push=function(){var a=new hterm.Terminal.IO(this.terminal_);a.keyboardCaptured_=this.keyboardCaptured_;a.previousIO_=this.terminal_.io;return this.terminal_.io=a};hterm.Terminal.IO.prototype.pop=function(){this.terminal_.io=this.previousIO_};hterm.Terminal.IO.prototype.sendString=function(a){console.log("Unhandled sendString: "+a)};hterm.Terminal.IO.prototype.onVTKeystroke=function(a){console.log("Unobserverd VT keystroke: "+JSON.stringify(a))};
hterm.Terminal.IO.prototype.onTerminalResize=function(){};hterm.Terminal.IO.prototype.print=function(a){if(this.terminal_.io!=this)throw"Attempt to print from inactive IO object.";this.terminal_.interpret(a)};hterm.Terminal.IO.prototype.println=function(a){this.terminal_.interpret(a+"\r\n")};lib.rtdep("lib.colors");hterm.TextAttributes=function(a){this.document_=a;this.backgroundIndex=this.foregroundIndex=null;this.background=this.foreground=this.DEFAULT_COLOR;this.invisible=this.inverse=this.underline=this.blink=this.bold=!1;this.colorPalette=null;this.resetColorPalette()};hterm.TextAttributes.prototype.enableBold=!0;hterm.TextAttributes.prototype.DEFAULT_COLOR=new String("");hterm.TextAttributes.prototype.setDocument=function(a){this.document_=a};
hterm.TextAttributes.prototype.clone=function(){var a=new hterm.TextAttributes(null),b;for(b in this)a[b]=this[b];a.colorPalette=this.colorPalette.concat();return a};hterm.TextAttributes.prototype.reset=function(){this.backgroundIndex=this.foregroundIndex=null;this.background=this.foreground=this.DEFAULT_COLOR;this.invisible=this.inverse=this.underline=this.blink=this.bold=!1};hterm.TextAttributes.prototype.resetColorPalette=function(){this.colorPalette=lib.colors.defaultColorPalette.concat()};
hterm.TextAttributes.prototype.isDefault=function(){return null==this.foregroundIndex&&null==this.backgroundIndex&&!this.bold&&!this.blink&&!this.underline&&!this.inverse&&!this.invisible};
hterm.TextAttributes.prototype.createContainer=function(a){if(this.isDefault())return this.document_.createTextNode(a);var b=this.document_.createElement("span"),c=b.style;this.foreground!=this.DEFAULT_COLOR&&(c.color=this.foreground);this.background!=this.DEFAULT_COLOR&&(c.backgroundColor=this.background,c.borderBottom="1px "+this.background+" solid");this.enableBold&&this.bold&&(c.fontWeight="bold");this.blink&&(c.fontStyle="italic");this.underline&&(c.textDecoration="underline");a&&(b.textContent=
a);return b};hterm.TextAttributes.prototype.matchesContainer=function(a){if("string"==typeof a||3==a.nodeType)return this.isDefault();a=a.style;return this.foreground==a.color&&this.background==a.backgroundColor&&(this.enableBold&&this.bold)==!!a.fontWeight&&this.blink==!!a.fontStyle&&this.underline==!!a.textDecoration};
hterm.TextAttributes.prototype.updateColors=function(a,b){var c=this.foregroundIndex,e=this.backgroundIndex,f=this.DEFAULT_COLOR,h=this.DEFAULT_COLOR;this.inverse&&(c=this.backgroundIndex,e=this.foregroundIndex,f=b,h=a);this.bold&&null!=c&&(8>c?c+=8:16<=c&&250>=c&&(c+=6));this.invisible&&(c=e);this.foreground=null==c?f:this.colorPalette[c];this.background=null==e?h:this.colorPalette[e]};
hterm.TextAttributes.containersMatch=function(a,b){if("string"==typeof a)return hterm.TextAttributes.containerIsDefault(b);if(a.nodeType!=b.nodeType)return!1;if(3==a.nodeType)return!0;var c=a.style,e=b.style;return c.color==e.color&&c.backgroundColor==e.backgroundColor&&c.fontWeight==e.fontWeight&&c.fontStyle==e.fontStyle&&c.textDecoration==e.textDecoration};hterm.TextAttributes.containerIsDefault=function(a){return"string"==typeof a||3==a.nodeType};lib.rtdep("lib.colors","lib.f","hterm.VT.CharacterMap");
hterm.VT=function(a){this.terminal=a;
this.parseState_=new hterm.VT.ParseState(this.parseUnknown_);this.trailingModifier_=this.leadingModifier_="";this.allowColumnWidthChanges_=!1;a=Object.keys(hterm.VT.CC1).map(function(a){return"\\x"+lib.f.zpad(a.charCodeAt().toString(16),2)}).join("");this.cc1Pattern_=RegExp("["+a+"]");this.utf8Decoder_=new lib.UTF8Decoder;this.enable8BitControl=!1;this.maxStringSequence=1024;this.warnUnimplemented=!0;this.G0=hterm.VT.CharacterMap.maps.B;this.G1=hterm.VT.CharacterMap.maps["0"];
this.G3=this.G2=hterm.VT.CharacterMap.maps.B;this.GR=this.GL="G0";this.savedState_=new hterm.VT.CursorState(this)};hterm.VT.ParseState=function(a,b){this.defaultFunction=a;this.buf=b||null;this.pos=0;this.func=a;this.args=[]};hterm.VT.ParseState.prototype.reset=function(a){this.resetParseFunction();this.resetBuf(a||"");this.resetArguments()};hterm.VT.ParseState.prototype.resetParseFunction=function(){this.func=this.defaultFunction};
hterm.VT.ParseState.prototype.resetBuf=function(a){this.buf="string"==typeof a?a:null;this.pos=0};hterm.VT.ParseState.prototype.resetArguments=function(a){this.args.length=0;"undefined"!=typeof a&&(this.args[0]=a)};hterm.VT.ParseState.prototype.iarg=function(a,b){var c=this.args[a];return c?(c=parseInt(c,10),0==c&&(c=b),c):b};hterm.VT.ParseState.prototype.advance=function(a){this.pos+=a};hterm.VT.ParseState.prototype.peekRemainingBuf=function(){return this.buf.substr(this.pos)};
hterm.VT.ParseState.prototype.peekChar=function(){return this.buf.substr(this.pos,1)};hterm.VT.ParseState.prototype.consumeChar=function(){return this.buf.substr(this.pos++,1)};hterm.VT.ParseState.prototype.isComplete=function(){return null==this.buf||this.buf.length<=this.pos};hterm.VT.CursorState=function(a){this.vt_=a;this.save()};
hterm.VT.CursorState.prototype.save=function(){this.cursor=this.vt_.terminal.saveCursor();this.textAttributes=this.vt_.terminal.getTextAttributes().clone();this.GL=this.vt_.GL;this.GR=this.vt_.GR;this.G0=this.vt_.G0;this.G1=this.vt_.G1;this.G2=this.vt_.G2;this.G3=this.vt_.G3};
hterm.VT.CursorState.prototype.restore=function(){this.vt_.terminal.restoreCursor(this.cursor);this.vt_.terminal.setTextAttributes(this.textAttributes.clone());this.vt_.GL=this.GL;this.vt_.GR=this.GR;this.vt_.G0=this.G0;this.vt_.G1=this.G1;this.vt_.G2=this.G2;this.vt_.G3=this.G3};hterm.VT.prototype.reset=function(){this.G0=hterm.VT.CharacterMap.maps.B;this.G1=hterm.VT.CharacterMap.maps["0"];this.G3=this.G2=hterm.VT.CharacterMap.maps.B;this.GR=this.GL="G0";this.savedState_=new hterm.VT.CursorState(this)};
hterm.VT.prototype.interpret=function(a){for(this.parseState_.resetBuf(this.decodeUTF8(a));!this.parseState_.isComplete();){var b=this.parseState_.func,c=this.parseState_.pos,a=this.parseState_.buf;this.parseState_.func.call(this,this.parseState_);if(this.parseState_.func==b&&this.parseState_.pos==c&&this.parseState_.buf==a)throw"Parser did not alter the state!";}};hterm.VT.prototype.encodeUTF8=function(a){return lib.encodeUTF8(a)};hterm.VT.prototype.decodeUTF8=function(a){return this.utf8Decoder_.decode(a)};
hterm.VT.prototype.parseUnknown_=function(a){function b(a){c[c.GL].GL&&(a=c[c.GL].GL(a));c[c.GR].GR&&(a=c[c.GR].GR(a));c.terminal.print(a)}var c=this,e=a.peekRemainingBuf(),f=e.search(this.cc1Pattern_);0==f?(this.dispatch("CC1",e.substr(0,1),a),a.advance(1)):-1==f?(b(e),a.reset()):(b(e.substr(0,f)),this.dispatch("CC1",e.substr(f,1),a),a.advance(f+1))};
hterm.VT.prototype.parseCSI_=function(a){var b=a.peekChar(),c=a.args;"@"<=b&&"~">=b?(this.dispatch("CSI",this.leadingModifier_+this.trailingModifier_+b,a),a.resetParseFunction()):";"==b?this.trailingModifier_?a.resetParseFunction():(c.length||c.push(""),c.push("")):"0"<=b&&"9">=b?this.trailingModifier_?a.resetParseFunction():c.length?c[c.length-1]+=b:c[0]=b:" "<=b&&"?">=b&&":"!=b?c.length?this.trailingModifier_+=b:this.leadingModifier_+=b:this.cc1Pattern_.test(b)?this.dispatch("CC1",b,a):a.resetParseFunction();
a.advance(1)};hterm.VT.prototype.parseUntilStringTerminator_=function(a){var b=a.peekRemainingBuf(),c=b.search(/(\x1b\\|\x07)/),e=a.args;e.length||(e[0]="");if(-1==c){e[0]+=b;if(e[0].length<=this.maxStringSequence)return a.advance(b.length),!0;a.reset(e[0]);return!1}if(e[0].length+c>this.maxStringSequence)return a.reset(e[0]+b),!1;e[0]+=b.substr(0,c);a.resetParseFunction();a.advance(c+("\u001b"==b.substr(c,1)?2:1));return!0};
hterm.VT.prototype.dispatch=function(a,b,c){var e=hterm.VT[a][b];e?e==hterm.VT.ignore?this.warnUnimplemented&&console.warn("Ignored "+a+" code: "+JSON.stringify(b)):"CC1"==a&&"\u007f"<b&&!this.enable8BitControl?console.warn("Ignoring 8-bit control code: 0x"+b.charCodeAt(0).toString(16)):e.apply(this,[c,b]):this.warnUnimplemented&&console.warn("Unknown "+a+" code: "+JSON.stringify(b))};
hterm.VT.prototype.setANSIMode=function(a,b){"4"==a?this.terminal.setInsertMode(b):"20"==a?this.terminal.setAutoCarriageReturn(b):this.warnUnimplemented&&console.warn("Unimplemented ANSI Mode: "+a)};
hterm.VT.prototype.setDECMode=function(a,b){switch(a){case "1":this.terminal.keyboard.applicationCursor=b;break;case "3":this.allowColumnWidthChanges_&&(this.terminal.setWidth(b?132:80),this.terminal.clearHome(),this.terminal.setVTScrollRegion(null,null));break;case "5":this.terminal.setReverseVideo(b);break;case "6":this.terminal.setOriginMode(b);break;case "7":this.terminal.setWraparound(b);break;case "12":this.terminal.setCursorBlink(b);break;case "25":this.terminal.setCursorVisible(b);break;case "40":this.terminal.allowColumnWidthChanges_=
b;break;case "45":this.terminal.setReverseWraparound(b);break;case "67":this.terminal.keyboard.backspaceSendsBackspace=b;break;case "1010":this.terminal.scrollOnOutput=b;break;case "1011":this.terminal.scrollOnKeystroke=b;break;case "1036":this.terminal.keyboard.metaSendsEscape=b;break;case "1039":this.terminal.keyboard.altSendsEscape=b;break;case "47":case "1047":this.terminal.setAlternateMode(b);break;case "1048":this.savedState_.save();case "1049":b?(this.savedState_.save(),this.terminal.setAlternateMode(b),
this.terminal.clear()):(this.terminal.setAlternateMode(b),this.savedState_.restore());break;default:this.warnUnimplemented&&console.warn("Unimplemented DEC Private Mode: "+a)}};hterm.VT.ignore=function(){};hterm.VT.CC1={};hterm.VT.ESC={};hterm.VT.CSI={};hterm.VT.OSC={};hterm.VT.VT52={};hterm.VT.CC1["\x00"]=hterm.VT.ignore;hterm.VT.CC1["\u0005"]=hterm.VT.ignore;hterm.VT.CC1["\u0007"]=function(){this.terminal.ringBell()};hterm.VT.CC1["\b"]=function(){this.terminal.cursorLeft(1)};
hterm.VT.CC1["\t"]=function(){this.terminal.forwardTabStop()};hterm.VT.CC1["\n"]=function(){this.terminal.formFeed()};hterm.VT.CC1["\x0B"]=hterm.VT.CC1["\n"];hterm.VT.CC1["\f"]=function(){this.terminal.formFeed()};hterm.VT.CC1["\r"]=function(){this.terminal.setCursorColumn(0)};hterm.VT.CC1["\u000e"]=function(){this.GL="G1"};hterm.VT.CC1["\u000f"]=function(){this.GL="G0"};hterm.VT.CC1["\u0011"]=hterm.VT.ignore;hterm.VT.CC1["\u0013"]=hterm.VT.ignore;
hterm.VT.CC1["\u0018"]=function(a){a.resetParseFunction();this.terminal.print("?")};hterm.VT.CC1["\u001a"]=hterm.VT.CC1["\u0018"];hterm.VT.CC1["\u001b"]=function(a){function b(a){var e=a.consumeChar();"\u001b"!=e&&(this.dispatch("ESC",e,a),a.func==b&&a.resetParseFunction())}a.func=b};hterm.VT.CC1["\u007f"]=hterm.VT.ignore;hterm.VT.CC1["\u0084"]=hterm.VT.ESC.D=function(){this.terminal.lineFeed()};hterm.VT.CC1["\u0085"]=hterm.VT.ESC.E=function(){this.terminal.setCursorColumn(0);this.terminal.cursorDown(1)};
hterm.VT.CC1["\u0088"]=hterm.VT.ESC.H=function(){this.terminal.setTabStop(this.terminal.getCursorColumn())};hterm.VT.CC1["\u008d"]=hterm.VT.ESC.M=function(){this.terminal.reverseLineFeed()};hterm.VT.CC1["\u008e"]=hterm.VT.ESC.N=hterm.VT.ignore;hterm.VT.CC1["\u008f"]=hterm.VT.ESC.O=hterm.VT.ignore;hterm.VT.CC1["\u0090"]=hterm.VT.ESC.P=function(a){a.resetArguments();a.func=this.parseUntilStringTerminator_};hterm.VT.CC1["\u0096"]=hterm.VT.ESC.V=hterm.VT.ignore;hterm.VT.CC1["\u0097"]=hterm.VT.ESC.W=hterm.VT.ignore;
hterm.VT.CC1["\u0098"]=hterm.VT.ESC.X=hterm.VT.ignore;hterm.VT.CC1["\u009a"]=hterm.VT.ESC.Z=function(){this.terminal.io.sendString("\u001b[?1;2c")};hterm.VT.CC1["\u009b"]=hterm.VT.ESC["["]=function(a){a.resetArguments();this.trailingModifier_=this.leadingModifier_="";a.func=this.parseCSI_};hterm.VT.CC1["\u009c"]=hterm.VT.ESC["\\"]=hterm.VT.ignore;
hterm.VT.CC1["\u009d"]=hterm.VT.ESC["]"]=function(a){function b(a){if(this.parseUntilStringTerminator_(a)&&a.func!=b){var e=a.args[0].match(/^(\d+);(.*)$/);e?(a.args[0]=e[2],this.dispatch("OSC",e[1],a)):console.warn("Invalid OSC: "+JSON.stringify(a.args[0]))}}a.resetArguments();a.func=b};hterm.VT.CC1["\u009e"]=hterm.VT.ESC["^"]=function(a){a.resetArguments();a.func=this.parseUntilStringTerminator_};hterm.VT.CC1["\u009f"]=hterm.VT.ESC._=function(a){a.resetArguments();a.func=this.parseUntilStringTerminator_};
hterm.VT.ESC[" "]=function(a){a.func=function(a){var c=a.consumeChar();this.warnUnimplemented&&console.warn("Unimplemented sequence: ESC 0x20 "+c);a.resetParseFunction()}};hterm.VT.ESC["#"]=function(a){a.func=function(a){var c=a.consumeChar();"8"==c?this.terminal.fill("E"):-1=="3456".indexOf(c)&&this.terminal.print("\u001b#"+c);a.resetParseFunction()}};
hterm.VT.ESC["%"]=function(a){a.func=function(a){var c=a.consumeChar();"@"!=c&&("G"!=c&&this.warnUnimplemented)&&console.warn("Unknown ESC % argument: "+JSON.stringify(c));a.resetParseFunction()}};
hterm.VT.ESC["("]=hterm.VT.ESC[")"]=hterm.VT.ESC["*"]=hterm.VT.ESC["+"]=hterm.VT.ESC["-"]=hterm.VT.ESC["."]=hterm.VT.ESC["/"]=function(a,b){a.func=function(a){var e=a.consumeChar();if("\u001b"==e)a.resetParseFunction(),a.func();else{if(e in hterm.VT.CharacterMap.maps)if("("==b)this.G0=hterm.VT.CharacterMap.maps[e];else if(")"==b||"-"==b)this.G1=hterm.VT.CharacterMap.maps[e];else if("*"==b||"."==b)this.G2=hterm.VT.CharacterMap.maps[e];else{if("+"==b||"/"==b)this.G3=hterm.VT.CharacterMap.maps[e]}else this.warnUnimplemented&&
console.log('Invalid character set for "'+b+'": '+e);a.resetParseFunction()}}};hterm.VT.ESC["6"]=hterm.VT.ignore;hterm.VT.ESC["7"]=function(){this.savedState_.save()};hterm.VT.ESC["8"]=function(){this.savedState_.restore()};hterm.VT.ESC["9"]=hterm.VT.ignore;hterm.VT.ESC["="]=function(){this.terminal.keyboard.applicationKeypad=!0};hterm.VT.ESC[">"]=function(){this.terminal.keyboard.applicationKeypad=!1};hterm.VT.ESC.F=hterm.VT.ignore;hterm.VT.ESC.c=function(){this.reset();this.terminal.reset()};
hterm.VT.ESC.l=hterm.VT.ESC.m=hterm.VT.ignore;hterm.VT.ESC.n=function(){this.GL="G2"};hterm.VT.ESC.o=function(){this.GL="G3"};hterm.VT.ESC["|"]=function(){this.GR="G3"};hterm.VT.ESC["}"]=function(){this.GR="G2"};hterm.VT.ESC["~"]=function(){this.GR="G1"};hterm.VT.OSC["0"]=function(a){this.terminal.setWindowTitle(a.args[0])};hterm.VT.OSC["2"]=hterm.VT.OSC["0"];
hterm.VT.OSC["4"]=function(a){for(var b=a.args[0].split(";"),a=parseInt(a.args.length/2),c=this.terminal.getTextAttributes().colorPalette,e=[],f=0;f<a;++f){var h=parseInt(b[2*f]),g=b[2*f+1];h>=c.length||("?"==g?(g=hterm.colors.rgbToX11(c[h]))&&e.push(h+";"+g):(g=hterm.colors.x11ToCSS(g))&&(c[h]=g))}e.length&&this.terminal.io.sendString("\u001b]4;"+e.join(";")+"\u0007")};hterm.VT.CSI["@"]=function(a){this.terminal.insertSpace(a.iarg(0,1))};
hterm.VT.CSI.A=function(a){this.terminal.cursorUp(a.iarg(0,1))};hterm.VT.CSI.B=function(a){this.terminal.cursorDown(a.iarg(0,1))};hterm.VT.CSI.C=function(a){this.terminal.cursorRight(a.iarg(0,1))};hterm.VT.CSI.D=function(a){this.terminal.cursorLeft(a.iarg(0,1))};hterm.VT.CSI.E=function(a){this.terminal.cursorDown(a.iarg(0,1));this.terminal.setCursorColumn(0)};hterm.VT.CSI.F=function(a){this.terminal.cursorUp(a.iarg(0,1));this.terminal.setCursorColumn(0)};
hterm.VT.CSI.G=function(a){this.terminal.setCursorColumn(a.iarg(0,1)-1)};hterm.VT.CSI.H=function(a){this.terminal.setCursorPosition(a.iarg(0,1)-1,a.iarg(1,1)-1)};hterm.VT.CSI.I=function(a){for(var a=a.iarg(0,1),a=lib.f.clamp(a,1,this.terminal.screenSize.width),b=0;b<a;b++)this.terminal.forwardTabStop()};
hterm.VT.CSI.J=hterm.VT.CSI["?J"]=function(a,b){var c=a.args[0];!c||"0"==c?this.terminal.eraseBelow():"1"==c?this.terminal.eraseAbove():"2"==c?this.terminal.clear():"3"==c?this.terminal.clear():this.terminal.print("\u001b["+b+args[0])};hterm.VT.CSI.K=hterm.VT.CSI["?K"]=function(a,b){var c=a.args[0];!c||"0"==c?this.terminal.eraseToRight():"1"==c?this.terminal.eraseToLeft():"2"==c?this.terminal.eraseLine():this.terminal.print("\u001b["+c+b)};
hterm.VT.CSI.L=function(a){this.terminal.insertLines(a.iarg(0,1))};hterm.VT.CSI.M=function(a){this.terminal.deleteLines(a.iarg(0,1))};hterm.VT.CSI.P=function(a){this.terminal.deleteChars(a.iarg(0,1))};hterm.VT.CSI.S=function(a){this.terminal.vtScrollUp(a.iarg(0,1))};hterm.VT.CSI.T=function(a){1>=a.args.length&&this.terminal.vtScrollDown(a.iarg(0,1))};hterm.VT.CSI[">T"]=hterm.VT.ignore;hterm.VT.CSI.X=function(a){this.terminal.eraseToRight(a.iarg(0,1))};
hterm.VT.CSI.Z=function(a){for(var a=a.iarg(0,1),a=lib.f.clamp(a,1,this.terminal.screenSize.width),b=0;b<a;b++)this.terminal.backwardTabStop()};hterm.VT.CSI["`"]=function(a){this.terminal.setCursorColumn(a.iarg(0,1)-1)};hterm.VT.CSI.b=hterm.VT.ignore;hterm.VT.CSI.c=function(a){(!a.args[0]||"0"==a.args[0])&&this.terminal.io.sendString("\u001b[?1;2c")};hterm.VT.CSI[">c"]=function(){this.terminal.io.sendString("\u001b[>0;256;0c")};
hterm.VT.CSI.d=function(a){this.terminal.setAbsoluteCursorRow(a.iarg(0,1)-1)};hterm.VT.CSI.f=hterm.VT.CSI.H;hterm.VT.CSI.g=function(a){!a.args[0]||"0"==a.args[0]?this.terminal.clearTabStopAtCursor(!1):"3"==a.args[0]&&this.terminal.clearAllTabStops()};hterm.VT.CSI.h=function(a){for(var b=0;b<a.args.length;b++)this.setANSIMode(a.args[b],!0)};hterm.VT.CSI["?h"]=function(a){for(var b=0;b<a.args.length;b++)this.setDECMode(a.args[b],!0)};hterm.VT.CSI.i=hterm.VT.CSI["?i"]=hterm.VT.ignore;
hterm.VT.CSI.l=function(a){for(var b=0;b<a.args.length;b++)this.setANSIMode(a.args[b],!1)};hterm.VT.CSI["?l"]=function(a){for(var b=0;b<a.args.length;b++)this.setDECMode(a.args[b],!1)};
hterm.VT.CSI.m=function(a){function b(b){return a.args.length<b+2||"5"!=a.args[b+1]?null:a.iarg(b+2,0)}var c=this.terminal.getTextAttributes();if(a.args.length){for(var e=0;e<a.args.length;e++){var f=a.iarg(e,0);if(30>f)0==f?c.reset():1==f?c.bold=!0:4==f?c.underline=!0:5==f?c.blink=!0:7==f?c.inverse=!0:8==f?c.invisible=!0:22==f?c.bold=!1:24==f?c.underline=!1:25==f?c.blink=!1:27==f?c.inverse=!1:28==f&&(c.invisible=!1);else if(50>f)if(38>f)c.foregroundIndex=f-30;else if(38==f){f=b(e);if(null==f)break;
e+=2;f>=c.colorPalette.length||(c.foregroundIndex=f)}else if(39==f)c.foregroundIndex=null;else if(48>f)c.backgroundIndex=f-40;else if(48==f){f=b(e);if(null==f)break;e+=2;f>=c.colorPalette.length||(c.backgroundIndex=f)}else c.backgroundIndex=null;else 90<=f&&97>=f?c.foregroundIndex=f-90+8:100<=f&&107>=f&&(c.foregroundIndex=f-100+8)}c.updateColors(this.terminal.getForegroundColor(),this.terminal.getBackgroundColor())}else c.reset()};hterm.VT.CSI[">m"]=hterm.VT.ignore;
hterm.VT.CSI.n=function(a){if("5"==a.args[0])this.terminal.io.sendString("\u001b0n");else if("6"==a.args[0]){var a=this.terminal.getCursorRow()+1,b=this.terminal.getCursorColumn()+1;this.terminal.io.sendString("\u001b["+a+";"+b+"R")}};hterm.VT.CSI[">n"]=hterm.VT.ignore;
hterm.VT.CSI["?n"]=function(a){if("6"==a.args[0]){var a=this.terminal.getCursorRow()+1,b=this.terminal.getCursorColumn()+1;this.terminal.io.sendString("\u001b["+a+";"+b+"R")}else"15"==a.args[0]?this.terminal.io.sendString("\u001b[?11n"):"25"==a.args[0]?this.terminal.io.sendString("\u001b[?21n"):"26"==a.args[0]?this.terminal.io.sendString("\u001b[?12;1;0;0n"):"53"==a.args[0]&&this.terminal.io.sendString("\u001b[?50n")};hterm.VT.CSI[">p"]=hterm.VT.ignore;hterm.VT.CSI["!p"]=function(){this.reset();this.terminal.softReset()};
hterm.VT.CSI.$p=hterm.VT.ignore;hterm.VT.CSI["?$p"]=hterm.VT.ignore;hterm.VT.CSI['"p']=hterm.VT.ignore;hterm.VT.CSI.q=hterm.VT.ignore;hterm.VT.CSI[" q"]=hterm.VT.ignore;hterm.VT.CSI['"q']=hterm.VT.ignore;hterm.VT.CSI.r=function(a){var b=a.args,a=b[0]?parseInt(b[0],10)-1:null,b=b[1]?parseInt(b[1],10)-1:null;this.terminal.setVTScrollRegion(a,b);this.terminal.setCursorPosition(0,0)};hterm.VT.CSI["?r"]=hterm.VT.ignore;hterm.VT.CSI.$r=hterm.VT.ignore;hterm.VT.CSI.s=function(){this.savedState_.save()};
hterm.VT.CSI["?s"]=hterm.VT.ignore;hterm.VT.CSI.t=hterm.VT.ignore;hterm.VT.CSI.$t=hterm.VT.ignore;hterm.VT.CSI[">t"]=hterm.VT.ignore;hterm.VT.CSI[" t"]=hterm.VT.ignore;hterm.VT.CSI.u=function(){this.terminal.restoreOptions()};hterm.VT.CSI[" u"]=hterm.VT.ignore;hterm.VT.CSI.$v=hterm.VT.ignore;hterm.VT.CSI["'w"]=hterm.VT.ignore;hterm.VT.CSI.x=hterm.VT.ignore;hterm.VT.CSI["*x"]=hterm.VT.ignore;hterm.VT.CSI.$x=hterm.VT.ignore;hterm.VT.CSI["'z"]=hterm.VT.ignore;hterm.VT.CSI.$z=hterm.VT.ignore;
hterm.VT.CSI["'{"]=hterm.VT.ignore;hterm.VT.CSI["'|"]=hterm.VT.ignore;hterm.VT.CSI[" }"]=hterm.VT.ignore;hterm.VT.CSI[" ~"]=hterm.VT.ignore;lib.rtdep("lib.f");hterm.VT.CharacterMap=function(a,b){this.name=a;this.GR=this.GL=null;b&&this.reset(b)};
hterm.VT.CharacterMap.prototype.reset=function(a){this.glmap=a;a=Object.keys(this.glmap).map(function(a){return"\\x"+lib.f.zpad(a.charCodeAt(0).toString(16))});this.glre=RegExp("["+a.join("")+"]","g");this.grmap={};a.forEach(function(a){var c=String.fromCharCode(a.charCodeAt(0)&128);this.grmap[c]=this.glmap[a]}.bind(this));a=Object.keys(this.grmap).map(function(a){return"\\x"+lib.f.zpad(a.charCodeAt(0).toString(16),2)});this.grre=RegExp("["+a.join("")+"]","g");this.GL=function(a){return a.replace(this.glre,
function(a){return this.glmap[a]}.bind(this))}.bind(this);this.GR=function(a){return a.replace(this.grre,function(a){return this.grmap[a]}.bind(this))}.bind(this)};hterm.VT.CharacterMap.maps={};
hterm.VT.CharacterMap.maps["0"]=new hterm.VT.CharacterMap("graphic",{"`":"\u25c6",a:"\u2592",b:"\u2409",c:"\u240c",d:"\u240d",e:"\u240a",f:"\u00b0",g:"\u00b1",h:"\u2424",i:"\u240b",j:"\u2518",k:"\u2510",l:"\u250c",m:"\u2514",n:"\u253c",o:"\u23ba",p:"\u23bb",q:"\u2500",r:"\u23bc",s:"\u23bd",t:"\u251c",u:"\u2524",v:"\u2534",w:"\u252c",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03c0","|":"\u2260","}":"\u00a3","~":"\u00b7"});hterm.VT.CharacterMap.maps.A=new hterm.VT.CharacterMap("british",{"#":"\u00a3"});
hterm.VT.CharacterMap.maps.B=new hterm.VT.CharacterMap("us",null);hterm.VT.CharacterMap.maps["4"]=new hterm.VT.CharacterMap("dutch",{"#":"\u00a3","@":"\u00be","[":"\u0132","\\":"\u00bd","]":"|","{":"\u00a8","|":"f","}":"\u00bc","~":"\u00b4"});hterm.VT.CharacterMap.maps.C=hterm.VT.CharacterMap.maps["5"]=new hterm.VT.CharacterMap("finnish",{"[":"\u00c4","\\":"\u00d6","]":"\u00c5","^":"\u00dc","`":"\u00e9","{":"\u00e4","|":"\u00f6","}":"\u00e5","~":"\u00fc"});
hterm.VT.CharacterMap.maps.R=new hterm.VT.CharacterMap("french",{"#":"\u00a3","@":"\u00e0","[":"\u00b0","\\":"\u00e7","]":"\u00a7","{":"\u00e9","|":"\u00f9","}":"\u00e8","~":"\u00a8"});hterm.VT.CharacterMap.maps.Q=new hterm.VT.CharacterMap("french canadian",{"@":"\u00e0","[":"\u00e2","\\":"\u00e7","]":"\u00ea","^":"\u00ee","`":"\u00f4","{":"\u00e9","|":"\u00f9","}":"\u00e8","~":"\u00fb"});
hterm.VT.CharacterMap.maps.K=new hterm.VT.CharacterMap("german",{"@":"\u00a7","[":"\u00c4","\\":"\u00d6","]":"\u00dc","{":"\u00e4","|":"\u00f6","}":"\u00fc","~":"\u00df"});hterm.VT.CharacterMap.maps.Y=new hterm.VT.CharacterMap("italian",{"#":"\u00a3","@":"\u00a7","[":"\u00b0","\\":"\u00e7","]":"\u00e9","`":"\u00f9","{":"\u00e0","|":"\u00f2","}":"\u00e8","~":"\u00ec"});
hterm.VT.CharacterMap.maps.E=hterm.VT.CharacterMap.maps["6"]=new hterm.VT.CharacterMap("norwegian/danish",{"@":"\u00c4","[":"\u00c6","\\":"\u00d8","]":"\u00c5","^":"\u00dc","`":"\u00e4","{":"\u00e6","|":"\u00f8","}":"\u00e5","~":"\u00fc"});hterm.VT.CharacterMap.maps.Z=new hterm.VT.CharacterMap("spanish",{"#":"\u00a3","@":"\u00a7","[":"\u00a1","\\":"\u00d1","]":"\u00bf","{":"\u00b0","|":"\u00f1","}":"\u00e7"});
hterm.VT.CharacterMap.maps["7"]=hterm.VT.CharacterMap.maps.H=new hterm.VT.CharacterMap("swedish",{"@":"\u00c9","[":"\u00c4","\\":"\u00d6","]":"\u00c5","^":"\u00dc","`":"\u00e9","{":"\u00e4","|":"\u00f6","}":"\u00e5","~":"\u00fc"});hterm.VT.CharacterMap.maps["="]=new hterm.VT.CharacterMap("swiss",{"#":"\u00f9","@":"\u00e0","[":"\u00e9","\\":"\u00e7","]":"\u00ea","^":"\u00ee",_:"\u00e8","`":"\u00f4","{":"\u00e4","|":"\u00f6","}":"\u00fc","~":"\u00fb"});
